{
  "hash": "25ba04c321f87ec97853f96d7f9df92e",
  "result": {
    "markdown": "---\ntitle: Regional Voting Preferences in the 2019 Philippine Senatorial Elections\ndescription: 'Looks like voting in the Philippines is all about location, location, location! Literacy and religion may not be factors, but hometown pride definitely is.'\ndate: '2022-04-17'\ncategories:\n  - python\n  - eda\n  - geospatial\nimage: thumbnail.jpeg\nformat:\n  html:\n    code-fold: true\n    css: styles.css\n---\n\n<!-- <h4>Looks like voting in the Philippines is all about location, location, location! Literacy and religion may not be factors, but hometown pride definitely is.</h4> -->\n![](thumbnail.jpeg)\n\n<h1>Overview</h1>\n\nOriginal submission was last 2019-05-29.\n\nThis jupyter notebook was created for our Data Mining and Wrangling class in AIM MSDS. In particular, this was done during our 2nd semester of class, as one of the core requirements. In this report, we sought to understand the results of the 2019 elections through descriptive statistics. We wanted to do exploratory data analysis on the following questions: <br>\n\n<ol>\n<li>  How did the various administrative regions of the Philippines voted for their senators?\n<li>  Is the voter preference homogeneous across the country, or is there a preferred candidate or party per region? More specifically, how does (1) religious affiliation, (2) educational attainment, and (2) sex play a major role on how the voters select their candidates.\n</ol>\n\n<h1>Acknowledgements</h1>\n\nThis analysis was done together with my Lab partner, Geogre Esleta.\n\n\n<h2>Load Requirement Package</h2>\n\nBefore anything else, let us first load all important modules for this exercise.\n\n::: {.cell execution_count=1}\n``` {.python .cell-code code-summary=\"Loading required modules\"}\nimport os\nimport io\nimport re\nimport time\nimport glob\nimport requests\nimport urllib.request\nimport numpy as np\nimport pandas as pd\nimport geopandas as gpd\nimport matplotlib.pyplot as plt\nfrom matplotlib.colors import LinearSegmentedColormap\nimport seaborn as sns\n```\n:::\n\n\nIt is important to identify the datasets we are going to use for this exercise. The two identified datasets the group intends to use are: the 2019 National Data and the 2015-2016 Census data.\n\nWith regards to 2019 National data, the team used a web scapper provided Prof. Alis. The web scapper downloaded the election results from the Commission of Elections' 2019 National and Local Elections website. The results were then stored in a local repository which is then easily accesible for the team. The 2019 elections results are broken down into two main directories: results and contest. In this exercise, the team will explore both directories to map out a comprehensive summary of the 2019 senatorial and party elections.\n\nSecondly, the 2015-2016 Census data has already been stored in a local repository for easier access. One of the main reasons why the team decided to use the 2015-2016 Census data is because of the lack of availability of recent data. The Philippine Statistics Authority only releases a comprehensive census survey ever six years. However for the purpose of this exercise, the team has agreed that the 2015-2016 census data can act as an appproximate for today's population.\n\n<h2>Methodology</h2>\n\n<h3>Step 1: Extract and collect the 2019 Elections (Results) data</h3>\n\nThe first directory to explore is the 2019 Election `results`. The `results` directory contains all electoral results from a regional level down to the barangay level. For each level, a specific `coc.json` file is stored. This file contains all electoral results data and metadata for both national and local elections. However for the purposes of this analysis, we will only look at the aggregated elections data at the regional level. The files that we are interested are the coc.json files associated to each province, as these files contain the metadata and data on the election results.\n\nThe main structure of each coc.json file contains the following main keys: `vbc`, `rs`, `sts`, `obs`, and `cos`. For the purpose of this exercise, the important key the group needs to extract is the `rs` key as this provides the each candidate's total votes per area. \nUnder the `rs` key, the following keys can be found: `cc`, `bo`, `v`, `tot`, `per`, and `ser`. Cross referencing these keys with official statements and comelec documentations suggests that important keys are as follows: `cc` pertaining to contest_type, `bo` pertaining to the candidate_id, and `v` pertaining to votes_per_province.\n\n| Paremeter | Description |\n|:-----|------|\n| cc   | Contestant Code |\n| bo  |  Contestant ID |\n| v    | Total Votes Per Contestant |\n| tot    |  Total Votes Per Province |\n\nHowever, it must be pointed out that the available data only goes as high as provincial data. If we want to process the provincial level, the team will have to aggregate the data up.\n\nThe group created utility functions for easier retrieval of the provincial elections datasets. The purpose for the utility functions (and future utility functions) are for initial cleaning and manipulations. This is to ensure each dataset is ready for aggregation.\n\nThe `get_province_coc` method unpacks each key and value from the `coc.json` dictionary into a cleaned up dataframe. In addition, the method identifies which region and province the file originated from by examining the filepath that was passed.\n\nThe `get_all_province_coc` method is a walker that goes through each of the results directory. The walker checks if the filename has an equal value to `coc.json`. If a `coc.json `was located, the `get_province_coc` method is applied with the filepath as the parameter. The resulting dataframe is then appended to a master dataframe for further extraction and analysis. For this exercise, the group only had to extract data up to the regional and provincial levels so only three wildcard were use for the `glob` walker.\n\nSpecial methods (`get_ncr_coc` and `get_all_ncr_coc`) were established to get the cities' `coc.json`. For the case of the NCR cities, theire associated `coc.json` files were one directory lower.\n\n<h4></h4>\n\n::: {.cell execution_count=2}\n``` {.python .cell-code code-summary=\"Function declaration for get_province_coc()\"}\ndef get_province_coc(filepath):\n    \"\"\"\n    Loads a single coc file. \n\n    Adds additional columns `region` and `province to the DataFrame,\n    depending on filepath.\n\n    Parameters\n    ----------\n    filepath    : filepath\n\n    Return\n    ------\n    df          : a dataframe\n    \"\"\"\n    output = []\n    with open(filepath, 'r') as f:\n        dirpath, filepath = os.path.split(filepath)\n        region = dirpath.split('/')[-2]\n        province = dirpath.split('/')[-1]\n        data = json.load(f)\n        for each in data['rs']:\n            row = [float(element) for element in list(each.values())]\n            output.append([data['vbc']] + row + [region] + [province])\n    df = pd.DataFrame(output,\n                      columns=['vbc', 'cc', 'bo', 'v', 'tot', 'per', 'ser',\n                               'region', 'province'])\n    return df\n```\n:::\n\n\n::: {.cell execution_count=3}\n``` {.python .cell-code code-summary=\"Function declaration for get_all_province_coc()\"}\ndef get_all_province_coc(tree):\n    \"\"\"\n    Loads all province COC files and saves them to a dataframe\n\n    Checks the filepath if filename is 'coc.json'\n\n    Created a new column to deal with the reclassification of\n        \"NEGROS ORIENTAL\" and \"NEGROS OCCIDENTAL\" to \"NIR\" \n            to match the PSA 2016 dataset.\n\n    Parameters\n    ----------\n    filepath    : filepath\n\n    Return\n    ------\n    df          : a dataframe\n    \"\"\"\n    total = pd.DataFrame()\n    for file in glob.glob(tree):\n        if os.path.basename(file) == 'coc.json':\n            df = get_province_coc(file)\n            total = total.append(df)\n    total.rename(columns={'region': 'region_raw'}, inplace=True)\n    total['region'] = total['region_raw'].copy()\n    total.loc[(total['province'] == \"NEGROS ORIENTAL\") |\n              (total['province'] == \"NEGROS OCCIDENTAL\"), 'region'] = 'NIR'\n    return total\n```\n:::\n\n\n::: {.cell execution_count=4}\n``` {.python .cell-code code-summary=\"Function declaration for get_ncr_coc()\"}\ndef get_ncr_coc(filepath):\n    \"\"\"\n    Loads a single coc file. \n\n    Adds additional columns `region` and `province to the DataFrame,\n    depending on filepath.\n\n    Parameters\n    ----------\n    filepath    : filepath\n\n    Return\n    ------\n    df          : a dataframe    \n\n    \"\"\"\n    output = []\n    with open(filepath, 'r') as f:\n        dirpath, filepath = os.path.split(filepath)\n        region = dirpath.split('/')[-3]\n        province = dirpath.split('/')[-2]\n        data = json.load(f)\n        for each in data['rs']:\n            row = [float(element) for element in list(each.values())]\n            output.append([data['vbc']] + row + [region] + [province])\n    df = pd.DataFrame(output,\n                      columns=['vbc', 'cc', 'bo', 'v', 'tot', 'per', 'ser',\n                               'region', 'province'])\n    return df\n```\n:::\n\n\n::: {.cell execution_count=5}\n``` {.python .cell-code code-summary=\"Function declaration for get_all_ncr_coc()\"}\ndef get_all_ncr_coc(tree):\n    \"\"\"\n    Loads all province COC files and saves them to a dataframe\n\n    Checks the filepath if filename is 'coc.json'\n\n    Parameters\n    ----------\n    filepath    : filepath\n\n    Return\n    ------\n    df          : a dataframe\n    \"\"\"\n    total = pd.DataFrame()\n    for file in glob.glob(tree):\n        if file.split('/')[7] == 'NCR':\n            if os.path.basename(file) == 'coc.json':\n                df = get_ncr_coc(file)\n                total = total.append(df)\n    total.rename(columns={'region': 'region_raw'}, inplace=True)\n    total['region'] = total['region_raw'].copy()\n    return total\n```\n:::\n\n\n#### With these utility functions inplace, the team can now apply these methods for easier access to the 2019 elections data. \n\nWe can now compile all of the election results with the following line:\n\n::: {.cell execution_count=6}\n``` {.python .cell-code code-summary=\"Compiling provinces data with NCR data\"}\ntree = '/mnt/data/public/elections/nle2019/results/*/*/*'\nncr_tree = '/mnt/data/public/elections/nle2019/results/*/*/*/*'\ndf_results = get_all_province_coc(tree)\ndf_results = df_results.append(get_all_ncr_coc(ncr_tree))\ndf_results.drop_duplicates(inplace=True)\n```\n:::\n\n\nLet's see what we have:\n\n| vbc | cc | bo | v | tot | per | ser | region_raw | province | region |\n|:--|--|---|---|---|---|---|---|---|---|\n| 0 |\t89550 |\t1.0 |\t1.0 |\t2004.0 |\t1708769.0 |\t0.11 |\t2800.0 |\tREGION I |\tILOCOS NORTE |\tREGION I |\n1 |\t89550 |\t1.0 |\t2.0 |\t1607.0 |\t1708769.0 |\t0.09 |\t2800.0 |\tREGION I |\tILOCOS NORTE |\tREGION I |\t\n2 |\t\t89550 |\t\t1.0 |\t\t3.0 |\t\t8772.0 |\t\t1708769.0 |\t0.51 |\t2800.0 |\tREGION I |\tILOCOS NORTE |\tREGION I |\t\n3 |\t\t89550 |\t1.0 |\t4.0 |\t1767.0 |\t1708769.0 |\t0.10 |\t2800.0 |\tREGION I |\tILOCOS NORTE |\tREGION I |\t\n4 |\t\t89550 |\t1.0 |\t5.0 |\t5068.0 |\t1708769.0 |\t0.29 |\t2800.0 |\tREGION I |\tILOCOS NORTE |\tREGION I |\t\n: {tbl-colwidths=\"[5,10,5,5,10,10,5,10,10,30]\"}\n\n### Next, let us examine the obtained dataset with actual election results. \n\nBy cross checking the results with [Comelec data](https://www.comelec.gov.ph/?r=2019NLE/ListsOfCandidates/CertifiedListofCandidates), we can identify the senators and party names.\n\nJust to check our data, we can look at an example senator from the dataset. By choosing `cc=1` and `bo=46`, we are actually highlighting Imee Marcos' senatorial candidacy results.\n\n::: {.cell execution_count=7}\n``` {.python .cell-code}\nfig, ax = plt.subplots()\nax.set_xlabel('Votes')\ndf_marcos = df_results.query('cc == 1 & bo == 46').copy()\ndf_marcos.groupby('region').sum()['v'].sort_values(\n    ascending=True).plot.barh(figsize=(10, 10),\n                              title='Contestant: 46 - Imee Marcos',\n                              color='#BF5209', ax=ax);\n```\n:::\n\n\n![](image1.png)\n\nAdditionally, let us check some descriptive statistics for the 2019 Elections dataset. More specifically, let us examine the `v` or `votes` column. The group will be highly dependent on the `votes` data so let us first do some initial statistics and visualizations.\n\n::: {.cell execution_count=8}\n``` {.python .cell-code}\ndf_regions = df_results.groupby(['region', 'province'])['v'].sum().to_frame()\ndf_regions = df_regions.rename(columns={'v': 'votes'})\ndf_regions.head()\n```\n:::\n\n\n| region | province | votes |\n|:--|--|--|\n| BARMM\t| BASILAN\t| 2093067.0 |\n| \t| LANAO DEL SUR| 4770462.0 |\n| \t| MAGUINDANAO\t| 5917983.0 |\n| \t| SULU\t| 3529555.0 |\n| \t| TAWI-TAWI\t| 1874486.0 |\n| CAR\t| ABRA\t| 1923481.0 |\n| \t| APAYAO\t| 703002.0 |\n| \t| BENGUET\t| 2426397.0 |\n| \t| IFUGAO\t| 1408688.0 |\n| \t| KALINGA\t| 1621414.0 |\n| \t| MOUNTAIN PROVINCE\t| 1074249.0 |\n| NCR\t| NATIONAL CAPITAL REGION - FOURTH DISTRICT\t| 22896771.0 |\n| \t| NATIONAL CAPITAL REGION - MANILA\t| 13461229.0 |\n| \t| NATIONAL CAPITAL REGION - SECOND DISTRICT\t| 29803007.0 |\n| \t| NATIONAL CAPITAL REGION - THIRD DISTRICT\t| 18481014.0 |\n| \t| TAGUIG - PATEROS\t| 10018306.0 |\n\n\nJust to explore, the code and image below shows the total votes in region 3. Notice that Bulacan has the highest number of votes, followed by Nueva Ecija, then Pampanga.\n\n::: {.cell execution_count=9}\n``` {.python .cell-code}\nfig, ax = plt.subplots()\nax.set_xlabel('Votes')\ndf_test.loc['REGION III',\"votes\"].plot.barh(color='#BF5209', ax=ax);\n```\n:::\n\n\n![Votes Distribution in Region III](image2.png){fig-align=\"left\"}\n\nHere we explore the vote distribution in the National Capital Region. The classification of district and cities were broken down by area (Manila, Taguig-Pateros, Second District, Third District, and Fourth District).The top number of votes came from the second district (mainly because of Quezon City), followed by the Fourth District, then the Third District.\n\n::: {.cell execution_count=10}\n``` {.python .cell-code}\nfig, ax = plt.subplots()\nax.set_xlabel('Votes')\ndf_test.loc['NCQ',\"votes\"].plot.barh(color='#BF5209', ax=ax);\n```\n:::\n\n\n![Votes Distribution in the National Capital Region](image3.png){fig-align=\"left\"}\n\nNext, we explore the distribution of votes in Region 4-A. Unsurprisingly, the population of votes is high in the population centers of Cavite, then Batangas, then Laguna.\n\n::: {.cell execution_count=11}\n``` {.python .cell-code}\nfig, ax = plt.subplots()\nax.set_xlabel('Votes')\ndf_test.loc['REGION IV-A',\"votes\"].plot.barh(color='#BF5209', ax=ax);\n```\n:::\n\n\n![Votes Distribution in the Region IV-A](image4.png){fig-align=\"left\"}\n\nFor now, let us also examine the distribution of election votes in region 7. Unsurprisingly, the votes are concentrated first in Cebu, followed by Bohol and Siquijor.\n\n::: {.cell execution_count=12}\n``` {.python .cell-code}\nfig, ax = plt.subplots()\nax.set_xlabel('Votes')\ndf_test.loc['REGION VII',\"votes\"].plot.barh(color='#BF5209', ax=ax);\n```\n:::\n\n\n![Votes Distribution in the Region VII](image5.png){fig-align=\"left\"}\n\nTo match the contestant ID to the contestant name, the `contest` files were also downloaded from the [Commission of Elections' 2019 National and Local Elections website](https://2019electionresults.comelec.gov.ph/#/dashboard) and stored in the local repository. Similar to the `results` directory, the `contest` directory contained json files for each contest type/position. Upon inspection of a sample file within the directory, the following values were obtained:\n\n\nThe pertinent keys from each json files were:\n   \n| Parameter | Description               |\n|-----------|---------------------------|\n|   cc      | Contest code              |\n|   cn      | Contest code name - location |\n|   ccc     | Contest code name         |\n|   type    | Contest type              |\n|   bos     | list of candidate parameters|\n\nUnder the `bos` key, we can extract each of the candidates' parameters. The more useful ones for the group's study include:\n\n| Parameter | Description               |\n|-----------|---------------------------|\n|   boc     | Contestant ID             |\n|   bon     | Contestant Name           |\n|   pn      | Party Name                |\n\n<h3>Step 2: Extract and collect the 2019 Elections (Contestant) data</h3>\n\nThe group also created utility functions for easier retrieval of the contestant datasets. This is to ensure each dataset is ready for aggregation. \n\nSimilar to the `get_province_coc`, the `get_contestant_attrib` method unpacks each key and value from the `{contest_number}.json` dictionary into a cleaned up dataframe. The method converts the `bos` directory into an additional list, which will also be appended into the resulting dataframe. \n\nThere are two (2) major political coalitions fighting for the senate seats:\n\n1. Hugpong ng Pagbabago (HNP)\n2. Otso Diretso\n\nSimilar to the `get_all_province_coc`, the `get_contestants_attrib` method is a walker that goes through each of the `contest` directory. The method will first append all `{contest_numer}.json` files into a singular dataframe. Next, the method creates a new column that identifies who among the senatorial candidates are part of the **Hugpong ng Pagbabago (HNP)** or **Otso Diretso campaign**.\n\n::: {.cell execution_count=13}\n``` {.python .cell-code}\ndef get_contestant_attrib(filepath):\n    \"\"\"\n    Returns the contestant json file into a dataframe\n\n    Parameters\n    ----------\n    filepath   : string\n\n    Returns\n    ----------\n    df         : pd.DataFrame of contestnat attributes\n\n    \"\"\"\n\n    contestants_values = []\n    with open(filepath, 'r') as file:\n        data = json.load(file)\n        attrib_keys = [key for key in list(data.keys())\n                       if isinstance(key, (str, float, int))]\n        attrib_values = [value for value in list(data.values())\n                         if isinstance(value, (str, float, int))]\n        contest_values = [list(contest.values()) for contest in data['bos']]\n        df = pd.DataFrame(contest_values,\n                          columns=list(data['bos'][0].keys()))\n        for k, v in zip(attrib_keys, attrib_values):\n            df[k] = v\n    return df\n\n\ndef get_contestants_attrib(filepath):\n    \"\"\"\n    Returns ALL contestant json files into a dataframe\n\n    Parameters\n    ----------\n    filepath   : string\n\n    Returns\n    ----------\n    df         : pd.DataFrame of contestant attributes\n\n    \"\"\"\n    df = pd.DataFrame()\n    for each_filepath in glob.glob(filepath):\n        df = df.append(get_contestant_attrib(each_filepath))\n    senators = df[df.cc == 1].copy()\n    senators['bon'] = senators['bon'].str.extract(pat='(.*?) \\(')\n    party = df[df.cc == 5567].copy()\n    df = senators.append(party)\n    df.drop_duplicates(inplace=True)\n    df.rename(columns={'boc': 'bo'}, inplace=True)\n    otso = ['AQUINO, BENIGNO BAM ', 'DIOKNO, CHEL', 'HILBAY, PILO',\n            'MACALINTAL, MACAROMY', 'GUTOC, SAMIRA', 'ALEJANO, GARY',\n            'ROXAS, MAR', 'TAÑADA,LORENZO ERIN TAPAT']\n    hnp = ['ANGARA, EDGARDO SONNY', 'BONG REVILLA, RAMON JR', 'CAYETANO, PIA',\n           'DELA ROSA, BATO', 'EJERCITO, ESTRADA JV', 'ESTRADA, JINGGOY',\n           'GO, BONG GO', 'MANGUDADATU, DONG', 'MANICAD, JIGGY',\n           'MARCOS, IMEE', 'PIMENTEL, KOKO', 'TOLENTINO, FRANCIS', \n           'VILLAR, CYNTHIA']\n    for o in otso:\n        df.loc[df.bon == o, 'coalition'] = \"Otso Diretso\"\n    for h in hnp:\n        df.loc[df.bon == h, 'coalition'] = \"HNP\"\n    df['coalition'] = df['coalition'].fillna('None')\n    return df\n```\n:::\n\n\nLet us run the `get_contestants_attrib`. This will be used later in the blog for our further analysis.\n\n::: {.cell execution_count=14}\n``` {.python .cell-code}\ncontestant_filepaths = '/mnt/data/public/elections/nle2019/contests/*'\ndf_contestants = get_contestants_attrib(contestant_filepaths)\ndf_contestants.head()\n```\n:::\n\n\n<div class='table'>\n| bo | bon                 | boi    | to | pc | pn                                                 | pcc | pcy | pcm | pck | cc                 | cn | ccc     | ccn | pre      | type     | coalition    |\n|---:|:---|:---|---:|---:|:---|----:|----:|----:|----:|:--------|---:|:--------|----:|:---------|:---------|:-------------|\n| 37 | HILBAY, PILO        | 52.png | 37 |  2 | AKSYON DEMOKRATIKO                                 |   1 |   1 |   1 |   1 |   1| SENATOR PHILIPPINES |  1 | SENATOR |   3 | national | Otso Diretso |\n|  7 | ALUNAN, RAFFY       | 53.png |  7 |  3 | BAGUMBAYAN VOLUNTEERS FOR A NEW PHILIPPINES         |   1 |   1 |   1 |   1 |   1| SENATOR PHILIPPINES |  1 | SENATOR |   3 | national | None         |\n| 14 | BALDEVARONA, BALDE  | 35.png | 14 |  7 | FILIPINO FAMILY PARTY                              |   1 |   1 |   1 |   1 |   1| SENATOR PHILIPPINES |  1 | SENATOR |   3 | national | None         |\n| 18 | CASIÑO, TOTI        | 20.png | 18 |  8 | KATIPUNAN NG DEMOKRATIKONG PILIPINO(KDP)            |   1 |   1 |   1 |   1 |    1| SENATOR PHILIPPINES |  1 | SENATOR |   3 | national | None         |\n| 21 | CHONG, GLENN        | 61.png | 21 |  8 | KATIPUNAN NG DEMOKRATIKONG PILIPINO(KDP)            |   1 |   1 |   1 |   1 |    1| SENATOR PHILIPPINES |  1 | SENATOR |   3 | national | None         |\n: {tbl-colwidths=\"[5,10,5,5,10,10,5,10,10,30]\"}\n</div>\n\nWe now have two dataframes: `df_results` containing the 2019 election results, and `df_contestants` containing the contestant information. These two dataframes can now be merged into a single dataframe. Let us also drop certain columns which we have deemed as unimportant.\n\n::: {.cell execution_count=15}\n``` {.python .cell-code}\ndef merge_comelec(results, contestants):\n    \"\"\"\n    Merge results dataframe with contestants dataframe\n\n    Parameters\n    ----------\n    results    : pd.DataFrame\n    contestants: pd.DataFrame\n\n\n    Returns\n    ----------\n    df         : pd.DataFrame of contestant attributes\n\n    \"\"\"\n\n    df = pd.merge(results, contestants, on=['bo', 'cc'], how='left')\n    df = df.drop(['vbc', 'boi', 'to', 'pc', 'pcc', 'pcy', 'pcm',\n                  'pck', 'ccc', 'pre', 'ser', 'cn'], axis=1)\n    df.columns = ['position', 'candidate_id', 'votes_per_province',\n                  'total_votes', 'votes_in_pct', 'region_raw', 'province',\n                  'region', 'candidate_name', 'party_name',\n                  'contest_position', 'contest_type', 'coalition']\n    return df\n```\n:::\n\n\nLet's merge the tables, then just check the unique regions using the `unique` method.\n\n::: {.cell execution_count=16}\n``` {.python .cell-code}\nnle2019 = merge_comelec(df_results, df_contestants)\nnle2019.region.unique()\n\narray(['REGION I', 'REGION IV-B', 'BARMM', 'REGION II', 'REGION III',\n       'REGION V', 'REGION VI', 'NIR', 'REGION VII', 'REGION VIII',\n       'REGION IX', 'REGION X', 'REGION XI', 'REGION XII', 'REGION XIII',\n       'REGION IV-A', 'CAR', 'NCR'], dtype=object)\n```\n:::\n\n\n<h3>Step 3: Load `Geopandas` for geospatial processing</h3>\n\n<h4>Loading the geospatial data </h4>\nThe Philippines is composed of **seventeen (17) administrative regions**. We can use the `geopandas` module to manage and pre-process geospatial data.\n\nLet us first load up a geopandas graph of the Philippines.\n\n::: {.cell execution_count=17}\n``` {.python .cell-code}\nfig, ax = plt.subplots(1, figsize=(10, 15), frameon=True)\n\nph0 = gpd.GeoDataFrame.from_file(\"ph_regions.shp\")\nph0.plot(ax=ax, cmap='Greens', edgecolor='#555555', k=18)\nax.set_title('Regions of the Philippines')\nax.spines['top'].set_visible(False)\nax.spines['right'].set_visible(False)\nax.spines['bottom'].set_visible(False)\nax.spines['left'].set_visible(False)\n\nfor ind, row in ph0.iterrows():\n    ax.text(row[\"geometry\"].centroid.x, row[\"geometry\"].centroid.y,\n            row[\"region\"])\n```\n:::\n\n\n![Map of the Philippines](image6-map.png){fig-align=\"left\"}\n\n<h4>Looking at Senatorial Results</h4>\nLet us look at the senatorial candidates. Let us total up the votes by candidate and see the top 12 winners.\n\n| Index | Candidate               | Votes       |\n|-------|------------------------|-------------|\n| 61    | VILLAR, CYNTHIA         | 23653546.0  |\n| 54    | POE, GRACE              | 20877585.0  |\n| 33    | GO, BONG GO             | 18979132.0  |\n| 18    | CAYETANO, PIA           | 18287782.0  |\n| 23    | DELA ROSA, BATO         | 17396249.0  |\n| 7     | ANGARA, EDGARDO SONNY   | 16826634.0  |\n| 39    | LAPID, LITO             | 16181906.0  |\n| 45    | MARCOS, IMEE            | 14735294.0  |\n| 59    | TOLENTINO, FRANCIS      | 14264142.0  |\n| 15    | BONG REVILLA, RAMON JR  | 13899831.0  |\n| 14    | BINAY, NANCY            | 13864931.0  |\n| 53    | PIMENTEL, KOKO          | 13529531.0  |\n\n\nLet's visualize this with a plot:\n\n::: {.cell execution_count=18}\n``` {.python .cell-code}\nfig, ax = plt.subplots(figsize=(15,8))\nplt.rcParams.update({'font.size': 14})\ndf_senator.set_index('Candidate').head(12).sort_values(\n    by='Votes', ascending=True).plot.barh(ax=ax,\n    title='Top 12 Candidates, in Millions', color='#BF5209', legend=False);\nax.set_xlabel('Total Votes');im\n```\n:::\n\n\n![Top 12 Senators by vote](image7-top12.png){fig-align=\"left\"}\n\n<h4>Top Senator Per Region</h4>\n\nWe want to find out won across all the regions. If there is any bias for cetain candidates.\nBased on our findings, we can see that candidate Cynthia Villar won majority of the regions. \n\nIt is interesting to note that the top ranking senator for Ilocos Region (Region I) and the Cordillera Administrative Region (CAR) is **Imee Marcos**, which hails from that region. This confirms that there is a \"Solid North\", and that support for the Marcoses still exists in that area.\n\nFor the Mindanao regions, the top candidate is **Bong Go**, former special assistant to President Duterte, who is from Mindanao.\n\nThese show that Philippine politics is **very regional in nature**. Voters will naturally support their hometown candidate, regardless of the issues surrounding that candidate. \n\n::: {.cell execution_count=19}\n``` {.python .cell-code}\ndf_senator_region = df_senators.groupby(\n    ['region', 'candidate_name']).agg({'votes_per_province': sum})\ndf_senator_region['rank'] = df_senator_region.groupby(\n    'region')['votes_per_province'].rank('dense', ascending=False)\ndf_senator_region = df_senator_region[df_senator_region['rank'] == 1].reset_index()\ndf_senator_region.columns = ['Region', 'Candidate Name', 'Votes', 'Rank']\ndf_senator_region\n```\n:::\n\n\nTop Candiate Per Region\n\n|    | Region   | Candidate Name   |      Votes |   Rank |\n|---:|:---------|:----------------|-----------:|-------:|\n|  0 | BARMM    | GO, BONG GO      |   768037   |    1   |\n|  1 | CAR      | MARCOS, IMEE     |   348303   |    1   |\n|  2 | NCR      | VILLAR, CYNTHIA  |  3345089   |    1   |\n|  3 | NIR      | VILLAR, CYNTHIA  |   856992   |    1   |\n|  4 | REGION I | MARCOS, IMEE     |  1661318   |    1   |\n|  5 | REGION II| VILLAR, CYNTHIA  |   915393   |    1   |\n|  6 | REGION III| VILLAR, CYNTHIA |  3056167   |    1   |\n|  7 | REGION IV-A| VILLAR, CYNTHIA |  3660112   |    1   |\n|  8 | REGION IV-B| VILLAR, CYNTHIA |   688494   |    1   |\n|  9 | REGION IX| GO, BONG GO      |   663927   |    1   |\n| 10 | REGION V | POE, GRACE       |  1417114   |    1   |\n| 11 | REGION VI| VILLAR, CYNTHIA  |  1064681   |    1   |\n| 12 | REGION VII| VILLAR, CYNTHIA |  1307605   |    1   |\n| 13 | REGION VIII| VILLAR, CYNTHIA|  1132757   |    1   |\n| 14 | REGION X | GO, BONG GO      |   949392   |    1   |\n| 15 | REGION XI| GO, BONG GO      |  1002771   |    1   |\n| 16 | REGION XII| VILLAR, CYNTHIA |   983354   |    1   |\n| 17 | REGION XIII| GO, BONG GO    |   777931   |    1   |\n\n::: {.cell execution_count=20}\n``` {.python .cell-code}\n(df_senator_region[df_senator_region['Rank'] == 1].reset_index().groupby(\n    'Candidate Name')['Rank'].sum().to_frame().sort_values(by='Rank')\n .reset_index())\n```\n:::\n\n\n::: {.cell execution_count=21}\n``` {.python .cell-code}\n fig, ax = plt.subplots()\n(df_senator_region[df_senator_region['Rank'] == 1].reset_index().groupby(\n    'Candidate Name')['Rank'].sum().to_frame().sort_values(by='Rank').plot\n .barh(color='#BF5209', ax=ax));\nax.set_xlabel('Rank');\n```\n:::\n\n\n---\nAcknowledgements:\n\nImages: https://primer.com.ph/blog/2016/02/04/philippine-elections-the-culture-the-drama-the-battle-2/\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {}
  }
}