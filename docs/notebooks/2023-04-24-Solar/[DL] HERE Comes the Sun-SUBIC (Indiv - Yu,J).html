<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Sandro Luis R. Silva – dl-here-comes-the-sun-subic-(indiv---yuj</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/profile.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-9FYFKWYLVG"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-9FYFKWYLVG', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Sandro Luis R. Silva</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html" rel="" target="">
 <span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resume.html" rel="" target="">
 <span class="menu-text">Resume</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/slrsilva/slrsilva.github.io" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">



<div style="padding:5px">
<font style="font-weight:bold;font-size:32px;color:#2c3393;">Here Comes The Sun: Clark Solar Power Plant</font>
</div>
<div style="padding:5px">
<font style="font-weight:bold;font-size:24px;color:#2c3393;">LT16 - Sandro Silva and Jac Lin Yu</font>
</div>
<div style="padding:5px">
<font style="font-weight:bold;font-size:15px;color:#2c3393;">Individual Project of Jac Lin Yu</font>
<div>

<hr>
<p><font style="font-weight:bold;font-size:32px;color:#2c3393;">Table of Contents</font></p>
<p><font style="font-size:16px"></font></p><font style="font-size:16px">
<p><strong><a href="#problem-statement">1. Problem Statement</a></strong></p>
<p><strong><a href="#methodology">2. Methodology</a></strong></p>
<ul>
<li><a href="#preq">2.1. Loading Prerequisites</a></li>
<li><a href="#data">2.2. Dataset and Preprocessing</a></li>
<li><a href="#train">2.3. Train, Validation, Test Split and Batch Generation</a></li>
<li><a href="#benchmark">2.4. Determining the Benchmark</a></li>
<li><a href="#model">2.5. Model Training and Selection</a>
<ul>
<li><a href="#lstm1">2.5.1 LSTM with 64 nodes</a></li>
<li><a href="#lstm2">2.5.2 LSTM with 32 nodes</a></li>
<li><a href="#lstm3">2.5.3 Stacked LSTM with 64 and 32 nodes</a></li>
<li><a href="#lstm4">2.5.4 Stacked LSTM with 32 and 64 nodes</a></li>
</ul></li>
</ul>
<p><strong><a href="#results">3. Results and Discussions</a></strong> * <a href="#res">3.1. Results</a> * <a href="#discussions">3.2. Discussions and Recommendations</a></p>
</font><p><font style="font-size:16px"><strong><a href="#summary">4. Summary and Main Learning Points</a></strong> * <a href="#summary">4.1. Summary</a> * <a href="#main">4.1. Main Learning Points</a> </font></p>
<div id="problem-statement">
<div style="padding:3px;">
<font style="font-weight:bold;font-size:20px;color:#2c3393;">1. Problem Statement</font>
</div>
<div style="padding-left: 20px; text-align: justify; font-size:16px; line-height:1.6">
<p>With the threat of climate change, governments and industries needed to make adjustments as a response to the changes in the priorities of the people. Being one of the biggest contributors to greenhouse gases, the energy industry has shifted its focus away from traditional fuel sources, such as oil and coal, to more alternative and sustainable solutions, such as hydroelectric, solar, and wind. This movement, however, poses new threats and challenges to existing power grids across the world due to the inherent variability and intermittency of renewable fuel source. The disruptions in the power grids and the possibility of an imbalanced load threaten to overwhelm the grid operators. <br><br> Renewable energy forecasting, in particular for solar generation supply as this is the most volatile renewable power source, may provide grid operators the ability to predict and balance energy generation and consumption. In addition, power grid operators will be able to balance and schedule the distribution of generated power for not only renewable power plants but also conventional (and rigid) power plants, such as coal and natural gas. This is currently important to the Philippines, as the Department of Energy has given priority to solar power plants. The government has promised to buy all power these plants produce at a fixed rate. This encourages production which increases supply, but demand remains constant. Therefore, conventional plants need to adjust their production or incur loses and cause instability to the grid.</p>
</div>
<div id="methodology">
<div style="padding:5px;">
<font style="font-weight:bold;font-size:20px;color:#2c3393;">2. Methodology</font>
</div>
<div id="preq">
<div style="padding:5px;">
<font style="font-weight:bold;font-size:15px;color:#2c3393;">2.1 Loading Prerequisites</font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:09:36.379473Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:09:36.376526Z&quot;}" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>warnings.simplefilter(action<span class="op">=</span><span class="st">'ignore'</span>, category<span class="op">=</span><span class="pp">FutureWarning</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:09:37.851051Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:09:36.381296Z&quot;}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> MinMaxScaler</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.datasets <span class="im">import</span> imdb</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.preprocessing <span class="im">import</span> sequence</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.models <span class="im">import</span> Sequential</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> layers</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.optimizers <span class="im">import</span> RMSprop, Adam</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.callbacks <span class="im">import</span> ModelCheckpoint, EarlyStopping</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="data">
<div style="padding:5px;">
<font style="font-weight:bold;font-size:15px;color:#2c3393;">2.2 Dataset and Preprocessing</font>
</div>
<div style="padding:5px;">
<p><font style="font-style:italic;font-size:15px;color:#2c3393;"> Here, we will load the already cleaned preprocessed dataset of solar generation per plant per hour. The cleaning was processed outside of this notebook, and followed a framework which follows the industry standard of imputing missing values.</font></p><font style="font-style:italic;font-size:15px;color:#2c3393;">
<b>To list a few processes:</b> - using the average between the before(t-1) and after hour(t+1) - using a 1-week average of all similar intervals (ex, if empty during hour 6 of dec 20, take the moving average of all hour 6 from dec 13-dec19) - using a 4-week moving average of that specific hour and day of the week (ex, if empty during hour 6 of dec 20, we take average of hour 6(dec 13, 6, 29, 22) </font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:06.474406Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:09:37.852646Z&quot;}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(<span class="st">'solar_dataset.xlsx'</span>, </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                   sheet_name<span class="op">=</span><span class="st">'subic'</span>, </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                   parse_dates<span class="op">=</span>[<span class="st">'DATETIME'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="padding:5px;">
<font style="font-style:italic;font-size:15px;color:#2c3393;"> Listed below are the columns and the corresponding datatype. </font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:06.482329Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:06.476183Z&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>DATETIME         datetime64[ns]
YEAR                      int64
MONTH                     int64
DAY                       int64
HOUR                      int64
RESOURCE_ID              object
MW                      float64
Location                 object
Temperature             float64
Dew Point               float64
Humidity                float64
Wind Speed                int64
Wind Gust                 int64
Pressure                float64
Condition                object
Location_Name            object
dtype: object</code></pre>
</div>
</div>
<div style="padding:5px;">
<font style="font-style:italic;font-size:15px;color:#2c3393;"> Drop some columns such as location, resource ID, and year. The information regarding the specific plant is unimportant since the scope has already been specified, therefore, there is only one value for each of the specified column. The year is not important since weather has no seasonality in terms of year. </font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:06.560535Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:06.548726Z&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>df.drop([<span class="st">'Location_Name'</span>, <span class="st">'Location'</span>, <span class="st">'YEAR'</span>, <span class="st">'RESOURCE_ID'</span>],axis<span class="op">=</span><span class="dv">1</span>,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="padding:5px;">
<font style="font-style:italic;font-size:15px;color:#2c3393;"> It is customary in traditional time-series regression to convert the <code>month</code>, <code>day</code>, <code>hour</code> into categorical data, which will be later used in one-hot encoding. In addition, this is the usual preprocessing used in the energy industry here in the Philippines. </font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:06.547480Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:06.501922Z&quot;}" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df.MONTH <span class="op">=</span> df.MONTH.astype(<span class="st">'str'</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df.DAY <span class="op">=</span> df.DAY.astype(<span class="st">'str'</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>df.HOUR <span class="op">=</span> df.HOUR.astype(<span class="st">'str'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="padding:5px;">
<font style="font-style:italic;font-size:15px;color:#2c3393;"> Let us append the main <code>df</code> with the one-hot encoded dataframe. These columns need to be further processed because keeping them as they are will give the model the wrong idea that months, day, hour, and conditions that have higher values are more significant. </font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:06.585107Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:06.562405Z&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df0 <span class="op">=</span> df.join(pd.get_dummies(df[[<span class="st">'MONTH'</span>,<span class="st">'DAY'</span>,<span class="st">'HOUR'</span>,<span class="st">'Condition'</span>]]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="padding:5px;">
<font style="font-style:italic;font-size:15px;color:#2c3393;"> Further dropping of columns as well as reordering of columns </font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:06.649075Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:06.643349Z&quot;}" data-execution_count="12">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df0 <span class="op">=</span> df0.drop([<span class="st">'DATETIME'</span>,<span class="st">'MONTH'</span>,<span class="st">'DAY'</span>,<span class="st">'HOUR'</span>,<span class="st">'Condition'</span>],</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>               axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:06.655662Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:06.650340Z&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df0 <span class="op">=</span> df0[[<span class="st">'Temperature'</span>,<span class="st">'MW'</span>] <span class="op">+</span> df0.columns[<span class="dv">2</span>:].tolist()].copy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:06.669018Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:06.657081Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df0 <span class="op">=</span> df0.astype(<span class="st">'float'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="padding:5px;">
<font style="font-style:italic;font-size:15px;color:#2c3393;"> Final <code>DataFrame</code> to be used </font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:06.689595Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:06.670227Z&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df0.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Temperature</th>
<th data-quarto-table-cell-role="th">MW</th>
<th data-quarto-table-cell-role="th">Dew Point</th>
<th data-quarto-table-cell-role="th">Humidity</th>
<th data-quarto-table-cell-role="th">Wind Speed</th>
<th data-quarto-table-cell-role="th">Wind Gust</th>
<th data-quarto-table-cell-role="th">Pressure</th>
<th data-quarto-table-cell-role="th">MONTH_1</th>
<th data-quarto-table-cell-role="th">MONTH_10</th>
<th data-quarto-table-cell-role="th">MONTH_11</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Condition_Partly Cloudy</th>
<th data-quarto-table-cell-role="th">Condition_Partly Cloudy / Windy</th>
<th data-quarto-table-cell-role="th">Condition_Rain</th>
<th data-quarto-table-cell-role="th">Condition_Rain / Windy</th>
<th data-quarto-table-cell-role="th">Condition_Rain Shower</th>
<th data-quarto-table-cell-role="th">Condition_Showers in the Vicinity</th>
<th data-quarto-table-cell-role="th">Condition_T-Storm</th>
<th data-quarto-table-cell-role="th">Condition_T-Storm / Windy</th>
<th data-quarto-table-cell-role="th">Condition_Thunder</th>
<th data-quarto-table-cell-role="th">Condition_Thunder in the Vicinity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>72.0</td>
<td>0.0</td>
<td>68.0</td>
<td>88.0</td>
<td>8.0</td>
<td>0.0</td>
<td>29.6</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>73.0</td>
<td>0.0</td>
<td>68.0</td>
<td>83.0</td>
<td>10.0</td>
<td>0.0</td>
<td>29.6</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>75.0</td>
<td>0.0</td>
<td>70.0</td>
<td>83.0</td>
<td>9.0</td>
<td>0.0</td>
<td>29.6</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>75.0</td>
<td>0.0</td>
<td>70.0</td>
<td>83.0</td>
<td>0.0</td>
<td>0.0</td>
<td>29.6</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>73.0</td>
<td>0.0</td>
<td>70.0</td>
<td>88.0</td>
<td>12.0</td>
<td>0.0</td>
<td>29.6</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>5 rows × 103 columns</p>
</div>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:06.693845Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:06.690841Z&quot;}" data-execution_count="16">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df0.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>(24018, 103)</code></pre>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:06.697671Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:06.695261Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>plant_capacity <span class="op">=</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="train">
<div style="padding:5px;">
<font style="font-weight:bold;font-size:15px;color:#2c3393;"> 2.3 Train,Validate,Test Split and Batch Generation</font>
</div>
<div style="padding:5px;">
<font style="font-style:italic;font-size:15px;color:#2c3393;"> For this analysis, a <code>.8</code>, <code>.1</code>, <code>.1</code>, train-validate-test split was implemented. Since we are dealing with a time-series, the train-validate-test split cannot be randomly selected from the dataset, splitting of dataset should be conducted in a chronogical order. Below we define the starting and ending <code>index</code> for each group </font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:06.704084Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:06.699334Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>train_validate_test_split <span class="op">=</span> [<span class="fl">.8</span>, <span class="fl">.1</span>, <span class="fl">.1</span>]</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>train_idx <span class="op">=</span> math.floor(df0.shape[<span class="dv">0</span>] <span class="op">*</span> train_validate_test_split[<span class="dv">0</span>])</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>val_idx <span class="op">=</span> math.floor(df0.shape[<span class="dv">0</span>] <span class="op">*</span> train_validate_test_split[<span class="dv">1</span>]) <span class="op">+</span> train_idx</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="padding:5px;">
<font style="font-style:italic;font-size:15px;color:#2c3393;"> The <code>generator</code> function below was utilized to yield the appropriate batch. Significant parameters include the <code>lookback</code>, or how far back of the data to consider, <code>delay</code>, or how far into the future are we forecasting, <code>batch_size</code>, refers to the number of training examples utilized in one iteration. </font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:06.714420Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:06.705919Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generator(data, lookback, delay, min_index, max_index, shuffle<span class="op">=</span><span class="va">False</span>, </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>              batch_size<span class="op">=</span><span class="dv">128</span>, step<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> max_index <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        max_index <span class="op">=</span> <span class="bu">len</span>(data) <span class="op">-</span> delay <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> min_index <span class="op">+</span> lookback</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="dv">1</span>:</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> shuffle:</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>            rows <span class="op">=</span> np.random.randint(min_index <span class="op">+</span> lookback, </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>                                     max_index, size<span class="op">=</span>batch_size)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> i <span class="op">+</span> batch_size <span class="op">&gt;=</span> max_index:</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>                i <span class="op">=</span> min_index <span class="op">+</span> lookback</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>            rows <span class="op">=</span> np.arange(i, <span class="bu">min</span>(i <span class="op">+</span> batch_size, max_index))</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>            i <span class="op">+=</span> <span class="bu">len</span>(rows)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>        samples <span class="op">=</span> np.zeros((<span class="bu">len</span>(rows), lookback <span class="op">//</span> step, data.shape[<span class="op">-</span><span class="dv">1</span>]))</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>        targets <span class="op">=</span> np.zeros((<span class="bu">len</span>(rows),))</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j, row <span class="kw">in</span> <span class="bu">enumerate</span>(rows):</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>            indices <span class="op">=</span> <span class="bu">range</span>(rows[j] <span class="op">-</span> lookback, rows[j], step)</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>            samples[j] <span class="op">=</span> data[indices]</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>            targets[j] <span class="op">=</span> data[rows[j] <span class="op">+</span> delay][<span class="dv">1</span>]</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> samples, targets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="padding:5px;">
<font style="font-style:italic;font-size:15px;color:#2c3393;"> Let us mean-center the dataset </font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:06.733679Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:06.716189Z&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>float_data <span class="op">=</span> df0.values</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>train_mean <span class="op">=</span> float_data[:train_idx].mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>float_data <span class="op">-=</span> train_mean</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>train_std <span class="op">=</span> float_data[:train_idx].std(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>float_data <span class="op">/=</span> train_std</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>train_mw_std <span class="op">=</span> train_std[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="padding:5px;">
<font style="font-style:italic;font-size:15px;color:#2c3393;"> An industry standard is to utilize a <code>lookback</code> of either <code>144 hours</code> (1 week), <code>288 hours</code> (2 weeks), or <code>720 hours</code> (1[30-day] month). The initial run was to utilized a <code>288 hour</code> lookback period due to group’s industry expert’s experience. However, outside consultation with industry experts said 1 week would suffice with this limited dataset. </font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:06.738779Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:06.735675Z&quot;}" data-execution_count="21">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>lookback <span class="op">=</span> <span class="dv">144</span> <span class="co"># lookback(consider) the previous week data</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>step <span class="op">=</span> <span class="dv">1</span> <span class="co"># in hourly granularity</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>delay <span class="op">=</span> <span class="dv">24</span> <span class="co"># to forecast the next 24 hours</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>batch_size <span class="op">=</span> <span class="dv">128</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:06.747574Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:06.740280Z&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>train_gen <span class="op">=</span> generator(float_data,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    lookback<span class="op">=</span>lookback,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    delay<span class="op">=</span>delay,</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    min_index<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    max_index<span class="op">=</span>train_idx,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    shuffle<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    step<span class="op">=</span>step,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>val_gen <span class="op">=</span> generator(float_data,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    lookback<span class="op">=</span>lookback,</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    delay<span class="op">=</span>delay,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    min_index<span class="op">=</span>train_idx<span class="op">+</span><span class="dv">1</span>,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    max_index<span class="op">=</span>val_idx,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    step<span class="op">=</span>step,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>test_gen <span class="op">=</span> generator(float_data,</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    lookback<span class="op">=</span>lookback,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    delay<span class="op">=</span>delay,</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    min_index<span class="op">=</span>val_idx,</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    max_index<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    step<span class="op">=</span>step,</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    batch_size<span class="op">=</span>batch_size)</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>val_steps <span class="op">=</span> (val_idx <span class="op">-</span> (train_idx<span class="op">+</span><span class="dv">1</span>) <span class="op">-</span> lookback)</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>test_steps <span class="op">=</span> (<span class="bu">len</span>(float_data) <span class="op">-</span> (val_idx<span class="op">+</span><span class="dv">1</span>) <span class="op">-</span> lookback)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="benchmark">
<div style="padding:5px;">
<font style="font-weight:bold;font-size:15px;color:#2c3393;">2.4 Benchmark</font>
</div>
<div style="padding:5px;">
<p><font style="font-style:italic;font-size:15px;color:#2c3393;"> Two metrics were used to establish a baseline error:</font></p><font style="font-style:italic;font-size:15px;color:#2c3393;">
<pre><code>(1) the naive method identified in a previous lecture, which we scaled to industry standard
(2) a different framework suggested by industry</code></pre>
</font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:20.276354Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:06.749600Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_naive_method():</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    batch_maes <span class="op">=</span> []</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> step <span class="kw">in</span> <span class="bu">range</span>(val_steps):</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> step <span class="op">%</span> <span class="dv">1000</span> <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(step)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        samples, targets <span class="op">=</span> <span class="bu">next</span>(val_gen)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        preds <span class="op">=</span> samples[:, <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>        mae <span class="op">=</span> np.mean(np.<span class="bu">abs</span>(preds <span class="op">-</span> targets))</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>        batch_maes.append(mae)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.mean(batch_maes)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>naive_method <span class="op">=</span> evaluate_naive_method()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0
1000
2000</code></pre>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:20.283104Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:20.279617Z&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'NAIVE METHOD 1:'</span>, <span class="ss">f'</span><span class="sc">{</span>((naive_method <span class="op">*</span> train_mw_std)<span class="op">/</span><span class="dv">22</span>)<span class="sc">:0.2%}</span><span class="ss">'</span>) <span class="co">#where 22 is the capacity of the plant</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NAIVE METHOD 1: 8.87%</code></pre>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:20.333058Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:20.285797Z&quot;}" data-execution_count="25">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>benchmark1 <span class="op">=</span> ((naive_method <span class="op">*</span> train_mw_std)<span class="op">/</span><span class="dv">22</span>) <span class="op">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div style="padding:5px;text-align:justify">
<p><font style="font-style:italic;font-size:17px;color:#2c3393;"> For establishing the 2nd baseline error, the team consulted the industry to determine a baseline error. However, even the industry is still conflicted on how to establish a baseline measurement. As of now, the baseline is still being established by policy makers and grid operators. <br></font></p><font style="font-style:italic;font-size:17px;color:#2c3393;">
<p>Luckily, consulting with industry experts gave the team a framework on how to establish a baseline error per plant. The resulting measure looked at the mean squared error of the day-ahead projection(DAP), also called scheduled (Ex-Ante or RTD), and the actual delivered (Ex-Post or RTX).</p>
This was then scaled as a percentage to the capacity of the plant. This was with processed with an industry expert and not included in the notebook. The yielding error resulted with a baseline of <code>3.64%</code> </font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:20.338659Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:20.335369Z&quot;}" data-execution_count="26">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>benchmark2 <span class="op">=</span> <span class="fl">3.64</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="model">
<div style="padding:5px;">
<font style="font-weight:bold;font-size:15px;color:#2c3393;">2.5 Model Training Selection</font>
</div>
<div style="padding:5px;">
<p><font style="font-style:italic;font-size:15px;color:#2c3393;"> Four models were trained:</font></p><font style="font-style:italic;font-size:15px;color:#2c3393;">
<pre><code>- LSTM with 64 nodes
- LSTM with 32 nodes
- Stacked LSTM(2 layer) with 64 and 32 nodes
- Stacked LSTM(2 layer) with 32 and 64 nodes</code></pre>
<p>Dropout of <code>0.2</code> and Recurrent Dropout of <code>0.2</code> and a <code>RMSProp</code> optimized was implemented for all three.</p>
The group decided to use a <code>Epoch=50</code>, with an EarlyStopping of <code>patience=10</code> and <code>min_delta=0.01</code> to avoid overfitting and to reduce runtime due to the limited time constraints. </font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:10:20.345114Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:20.341275Z&quot;}" data-execution_count="27">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>steps_per_epoch_cnt <span class="op">=</span> math.floor(train_idx<span class="op">/</span>batch_size)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>val_steps_cnt <span class="op">=</span> <span class="bu">round</span>(math.floor((val_idx<span class="op">-</span>train_idx)<span class="op">/</span>batch_size),<span class="op">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="lstm1">
<div style="padding:20px;">
<font style="font-weight:bold;font-size:15px;color:#2c3393;">2.5.1 LSTM with 64</font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:14:50.825091Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:10:20.348201Z&quot;}" data-execution_count="28">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>filepath_lstm64<span class="op">=</span><span class="st">"clark_best_lstm64.hdf5"</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>cp_lstm64 <span class="op">=</span> ModelCheckpoint(filepath_lstm64, monitor<span class="op">=</span><span class="st">'val_loss'</span>, verbose<span class="op">=</span><span class="dv">2</span>, save_best_only<span class="op">=</span><span class="va">True</span>, mode<span class="op">=</span><span class="st">'min'</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>es_lstm64 <span class="op">=</span> EarlyStopping(monitor<span class="op">=</span><span class="st">'val_loss'</span>, mode<span class="op">=</span><span class="st">'min'</span>, verbose<span class="op">=</span><span class="dv">2</span>, patience<span class="op">=</span><span class="dv">10</span>, min_delta<span class="op">=</span><span class="fl">.01</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>callbacks_list_lstm64 <span class="op">=</span> [cp_lstm64, es_lstm64]</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># fix random seed for reproducibility</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>seed <span class="op">=</span> <span class="dv">1337</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>np.random.seed(seed)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>model_lstm64 <span class="op">=</span> Sequential()</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>model_lstm64.add(layers.LSTM(<span class="dv">64</span>, </span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>                       dropout<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>                       recurrent_dropout<span class="op">=</span><span class="fl">0.2</span>, </span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>                       input_shape<span class="op">=</span>(<span class="va">None</span>, float_data.shape[<span class="op">-</span><span class="dv">1</span>])))</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>model_lstm64.add(layers.Dense(<span class="dv">64</span>,activation<span class="op">=</span><span class="st">'relu'</span>))</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>model_lstm64.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>model_lstm64.<span class="bu">compile</span>(optimizer<span class="op">=</span>RMSprop(), loss<span class="op">=</span><span class="st">'mae'</span>)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>history_lstm64 <span class="op">=</span> model_lstm64.fit_generator(train_gen,</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>                                        steps_per_epoch<span class="op">=</span>steps_per_epoch_cnt, </span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>                                        epochs<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>                                        validation_data<span class="op">=</span>val_gen, </span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>                                        validation_steps<span class="op">=</span>val_steps_cnt,</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>                                        callbacks<span class="op">=</span>callbacks_list_lstm64, verbose<span class="op">=</span><span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>WARNING:tensorflow:From /home/jaclin/anaconda3/lib/python3.7/site-packages/tensorflow/python/ops/resource_variable_ops.py:435: colocate_with (from tensorflow.python.framework.ops) is deprecated and will be removed in a future version.
Instructions for updating:
Colocations handled automatically by placer.
WARNING:tensorflow:From /home/jaclin/anaconda3/lib/python3.7/site-packages/tensorflow/python/keras/backend.py:4010: calling dropout (from tensorflow.python.ops.nn_ops) with keep_prob is deprecated and will be removed in a future version.
Instructions for updating:
Please use `rate` instead of `keep_prob`. Rate should be set to `rate = 1 - keep_prob`.
WARNING:tensorflow:From /home/jaclin/anaconda3/lib/python3.7/site-packages/tensorflow/python/ops/math_ops.py:3066: to_int32 (from tensorflow.python.ops.math_ops) is deprecated and will be removed in a future version.
Instructions for updating:
Use tf.cast instead.
Epoch 1/50
20/20 [==============================] - 1s 45ms/step - loss: 0.2421

Epoch 00001: val_loss improved from inf to 0.24213, saving model to clark_best_lstm64.hdf5
 - 19s - loss: 0.4244 - val_loss: 0.2421
Epoch 2/50
20/20 [==============================] - 1s 43ms/step - loss: 0.2260

Epoch 00002: val_loss improved from 0.24213 to 0.22596, saving model to clark_best_lstm64.hdf5
 - 21s - loss: 0.2940 - val_loss: 0.2260
Epoch 3/50
20/20 [==============================] - 1s 40ms/step - loss: 0.2035

Epoch 00003: val_loss improved from 0.22596 to 0.20355, saving model to clark_best_lstm64.hdf5
 - 21s - loss: 0.2379 - val_loss: 0.2035
Epoch 4/50
20/20 [==============================] - 1s 42ms/step - loss: 0.2291

Epoch 00004: val_loss did not improve from 0.20355
 - 21s - loss: 0.2035 - val_loss: 0.2291
Epoch 5/50
20/20 [==============================] - 1s 42ms/step - loss: 0.2306

Epoch 00005: val_loss did not improve from 0.20355
 - 20s - loss: 0.1880 - val_loss: 0.2306
Epoch 6/50
20/20 [==============================] - 1s 40ms/step - loss: 0.2080

Epoch 00006: val_loss did not improve from 0.20355
 - 21s - loss: 0.1816 - val_loss: 0.2080
Epoch 7/50
20/20 [==============================] - 1s 41ms/step - loss: 0.2186

Epoch 00007: val_loss did not improve from 0.20355
 - 21s - loss: 0.1706 - val_loss: 0.2186
Epoch 8/50
20/20 [==============================] - 1s 40ms/step - loss: 0.2124

Epoch 00008: val_loss did not improve from 0.20355
 - 21s - loss: 0.1624 - val_loss: 0.2124
Epoch 9/50
20/20 [==============================] - 1s 41ms/step - loss: 0.2054

Epoch 00009: val_loss did not improve from 0.20355
 - 21s - loss: 0.1548 - val_loss: 0.2054
Epoch 10/50
20/20 [==============================] - 1s 41ms/step - loss: 0.2036

Epoch 00010: val_loss did not improve from 0.20355
 - 20s - loss: 0.1517 - val_loss: 0.2036
Epoch 11/50
20/20 [==============================] - 1s 40ms/step - loss: 0.2477

Epoch 00011: val_loss did not improve from 0.20355
 - 20s - loss: 0.1469 - val_loss: 0.2477
Epoch 12/50
20/20 [==============================] - 1s 45ms/step - loss: 0.1994

Epoch 00012: val_loss improved from 0.20355 to 0.19939, saving model to clark_best_lstm64.hdf5
 - 22s - loss: 0.1445 - val_loss: 0.1994
Epoch 13/50
20/20 [==============================] - 1s 44ms/step - loss: 0.2224

Epoch 00013: val_loss did not improve from 0.19939
 - 21s - loss: 0.1363 - val_loss: 0.2224
Epoch 00013: early stopping</code></pre>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:14:51.038549Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:14:50.826793Z&quot;}" data-execution_count="29">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>loss_lstm64 <span class="op">=</span> history_lstm64.history[<span class="st">'loss'</span>]</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>val_loss_lstm64 <span class="op">=</span> history_lstm64.history[<span class="st">'val_loss'</span>]</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(loss_lstm64) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs, loss_lstm64, <span class="st">'bo'</span>, label<span class="op">=</span><span class="st">'Training loss'</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs, val_loss_lstm64, <span class="st">'b'</span>, label<span class="op">=</span><span class="st">'Validation loss'</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Training and validation loss'</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="[DL] HERE Comes the Sun-SUBIC (Indiv - Yu,J)_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:14:51.043401Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:14:51.040324Z&quot;}" data-execution_count="30">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Model Error:'</span>, <span class="ss">f'</span><span class="sc">{</span>((<span class="bu">min</span>(val_loss_lstm64) <span class="op">*</span> train_mw_std)<span class="op">/</span>plant_capacity)<span class="sc">:0.2%}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model Error: 1.44%</code></pre>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:14:51.048629Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:14:51.045426Z&quot;}" data-execution_count="31">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>lstm64 <span class="op">=</span> ((<span class="bu">min</span>(val_loss_lstm64) <span class="op">*</span> train_mw_std)<span class="op">/</span>plant_capacity) <span class="op">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="lstm2">
<div style="padding:20px;">
<font style="font-weight:bold;font-size:15px;color:#2c3393;">2.5.2 LSTM with 32 nodes</font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:19:47.874949Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:14:51.050691Z&quot;}" data-execution_count="32">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>filepath_lstm32<span class="op">=</span><span class="st">"clark_best_lstm32.hdf5"</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>cp_lstm32 <span class="op">=</span> ModelCheckpoint(filepath_lstm32, monitor<span class="op">=</span><span class="st">'val_loss'</span>, verbose<span class="op">=</span><span class="dv">2</span>, save_best_only<span class="op">=</span><span class="va">True</span>, mode<span class="op">=</span><span class="st">'min'</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>es_lstm32 <span class="op">=</span> EarlyStopping(monitor<span class="op">=</span><span class="st">'val_loss'</span>, mode<span class="op">=</span><span class="st">'min'</span>, verbose<span class="op">=</span><span class="dv">2</span>, patience<span class="op">=</span><span class="dv">10</span>, min_delta<span class="op">=</span><span class="fl">.01</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>callbacks_list_lstm32 <span class="op">=</span> [cp_lstm32, es_lstm32]</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co"># fix random seed for reproducibility</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>seed <span class="op">=</span> <span class="dv">1337</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>np.random.seed(seed)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>model_lstm32 <span class="op">=</span> Sequential()</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>model_lstm32.add(layers.LSTM(<span class="dv">32</span>, </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>                       dropout<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>                       recurrent_dropout<span class="op">=</span><span class="fl">0.2</span>, </span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>                       input_shape<span class="op">=</span>(<span class="va">None</span>, float_data.shape[<span class="op">-</span><span class="dv">1</span>])))</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>model_lstm32.add(layers.Dense(<span class="dv">32</span>, activation<span class="op">=</span><span class="st">'relu'</span>))</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>model_lstm32.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>model_lstm32.<span class="bu">compile</span>(optimizer<span class="op">=</span>RMSprop(), loss<span class="op">=</span><span class="st">'mae'</span>)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>history_lstm32 <span class="op">=</span> model_lstm32.fit_generator(train_gen,</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>                                        steps_per_epoch<span class="op">=</span>steps_per_epoch_cnt, </span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>                                        epochs<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>                                        validation_data<span class="op">=</span>val_gen, </span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>                                        validation_steps<span class="op">=</span>val_steps_cnt,</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>                                        callbacks<span class="op">=</span>callbacks_list_lstm32, verbose<span class="op">=</span><span class="dv">2</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/50
20/20 [==============================] - 1s 34ms/step - loss: 0.2359

Epoch 00001: val_loss improved from inf to 0.23593, saving model to clark_best_lstm32.hdf5
 - 17s - loss: 0.4811 - val_loss: 0.2359
Epoch 2/50
20/20 [==============================] - 1s 30ms/step - loss: 0.2314

Epoch 00002: val_loss improved from 0.23593 to 0.23142, saving model to clark_best_lstm32.hdf5
 - 15s - loss: 0.3305 - val_loss: 0.2314
Epoch 3/50
20/20 [==============================] - 1s 31ms/step - loss: 0.2202

Epoch 00003: val_loss improved from 0.23142 to 0.22023, saving model to clark_best_lstm32.hdf5
 - 15s - loss: 0.2887 - val_loss: 0.2202
Epoch 4/50
20/20 [==============================] - 1s 30ms/step - loss: 0.2305

Epoch 00004: val_loss did not improve from 0.22023
 - 15s - loss: 0.2572 - val_loss: 0.2305
Epoch 5/50
20/20 [==============================] - 1s 30ms/step - loss: 0.2144

Epoch 00005: val_loss improved from 0.22023 to 0.21437, saving model to clark_best_lstm32.hdf5
 - 15s - loss: 0.2366 - val_loss: 0.2144
Epoch 6/50
20/20 [==============================] - 1s 30ms/step - loss: 0.2146

Epoch 00006: val_loss did not improve from 0.21437
 - 15s - loss: 0.2151 - val_loss: 0.2146
Epoch 7/50
20/20 [==============================] - 1s 29ms/step - loss: 0.1948

Epoch 00007: val_loss improved from 0.21437 to 0.19485, saving model to clark_best_lstm32.hdf5
 - 15s - loss: 0.2005 - val_loss: 0.1948
Epoch 8/50
20/20 [==============================] - 1s 30ms/step - loss: 0.2154

Epoch 00008: val_loss did not improve from 0.19485
 - 16s - loss: 0.1869 - val_loss: 0.2154
Epoch 9/50
20/20 [==============================] - 1s 30ms/step - loss: 0.2095

Epoch 00009: val_loss did not improve from 0.19485
 - 15s - loss: 0.1743 - val_loss: 0.2095
Epoch 10/50
20/20 [==============================] - 1s 36ms/step - loss: 0.2087

Epoch 00010: val_loss did not improve from 0.19485
 - 17s - loss: 0.1674 - val_loss: 0.2087
Epoch 11/50
20/20 [==============================] - 1s 54ms/step - loss: 0.2268

Epoch 00011: val_loss did not improve from 0.19485
 - 22s - loss: 0.1650 - val_loss: 0.2268
Epoch 12/50
20/20 [==============================] - 1s 43ms/step - loss: 0.1882

Epoch 00012: val_loss improved from 0.19485 to 0.18820, saving model to clark_best_lstm32.hdf5
 - 22s - loss: 0.1633 - val_loss: 0.1882
Epoch 13/50
20/20 [==============================] - 1s 35ms/step - loss: 0.2057

Epoch 00013: val_loss did not improve from 0.18820
 - 19s - loss: 0.1543 - val_loss: 0.2057
Epoch 14/50
20/20 [==============================] - 1s 35ms/step - loss: 0.2006

Epoch 00014: val_loss did not improve from 0.18820
 - 19s - loss: 0.1561 - val_loss: 0.2006
Epoch 15/50
20/20 [==============================] - 1s 35ms/step - loss: 0.2172

Epoch 00015: val_loss did not improve from 0.18820
 - 19s - loss: 0.1506 - val_loss: 0.2172
Epoch 16/50
20/20 [==============================] - 1s 35ms/step - loss: 0.1941

Epoch 00016: val_loss did not improve from 0.18820
 - 19s - loss: 0.1504 - val_loss: 0.1941
Epoch 17/50
20/20 [==============================] - 1s 35ms/step - loss: 0.2072

Epoch 00017: val_loss did not improve from 0.18820
 - 18s - loss: 0.1448 - val_loss: 0.2072
Epoch 00017: early stopping</code></pre>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:19:48.094761Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:19:47.876978Z&quot;}" data-execution_count="33">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>loss_lstm32 <span class="op">=</span> history_lstm32.history[<span class="st">'loss'</span>]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>val_loss_lstm32 <span class="op">=</span> history_lstm32.history[<span class="st">'val_loss'</span>]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(loss_lstm32) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs, loss_lstm32, <span class="st">'bo'</span>, label<span class="op">=</span><span class="st">'Training loss'</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs, val_loss_lstm32, <span class="st">'b'</span>, label<span class="op">=</span><span class="st">'Validation loss'</span>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Training and validation loss'</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="[DL] HERE Comes the Sun-SUBIC (Indiv - Yu,J)_files/figure-html/cell-30-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:19:48.099412Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:19:48.096245Z&quot;}" data-execution_count="34">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Model Error:'</span>, <span class="ss">f'</span><span class="sc">{</span>((<span class="bu">min</span>(val_loss_lstm32) <span class="op">*</span> train_mw_std)<span class="op">/</span>plant_capacity)<span class="sc">:0.2%}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model Error: 1.36%</code></pre>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:19:48.104418Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:19:48.100830Z&quot;}" data-execution_count="35">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>lstm32 <span class="op">=</span> ((<span class="bu">min</span>(val_loss_lstm32) <span class="op">*</span> train_mw_std)<span class="op">/</span>plant_capacity) <span class="op">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="lstm3">
<div style="padding:20px;">
<font style="font-weight:bold;font-size:15px;color:#2c3393;">2.5.3 Stacked LSTM with 64 and 32 nodes</font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:30:50.211207Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:19:48.106442Z&quot;}" data-execution_count="36">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>filepath_lstm6432<span class="op">=</span><span class="st">"clark_best_lstm6432.hdf5"</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>cp_lstm6432 <span class="op">=</span> ModelCheckpoint(filepath_lstm6432, monitor<span class="op">=</span><span class="st">'val_loss'</span>, verbose<span class="op">=</span><span class="dv">2</span>, save_best_only<span class="op">=</span><span class="va">True</span>, mode<span class="op">=</span><span class="st">'min'</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>es_lstm6432 <span class="op">=</span> EarlyStopping(monitor<span class="op">=</span><span class="st">'val_loss'</span>, mode<span class="op">=</span><span class="st">'min'</span>, verbose<span class="op">=</span><span class="dv">2</span>, patience<span class="op">=</span><span class="dv">10</span>, min_delta<span class="op">=</span><span class="fl">.01</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>callbacks_list_lstm6432 <span class="op">=</span> [cp_lstm6432, es_lstm6432]</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co"># fix random seed for reproducibility</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>seed <span class="op">=</span> <span class="dv">1337</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>np.random.seed(seed)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>model_lstm6432 <span class="op">=</span> Sequential()</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>model_lstm6432.add(layers.LSTM(<span class="dv">64</span>,</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>                    dropout<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>                    recurrent_dropout<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>                    return_sequences<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>                    input_shape<span class="op">=</span>(<span class="va">None</span>, float_data.shape[<span class="op">-</span><span class="dv">1</span>])))</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>model_lstm6432.add(layers.LSTM(<span class="dv">32</span>,</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>                    dropout<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>                    recurrent_dropout<span class="op">=</span><span class="fl">0.2</span>))</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>model_lstm6432.add(layers.Dense(<span class="dv">32</span>, activation<span class="op">=</span><span class="st">'relu'</span>))</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>model_lstm6432.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>model_lstm6432.<span class="bu">compile</span>(optimizer<span class="op">=</span>RMSprop(), loss<span class="op">=</span><span class="st">'mae'</span>)</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>history_lstm6432 <span class="op">=</span> model_lstm6432.fit_generator(train_gen,</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>                                             steps_per_epoch<span class="op">=</span>steps_per_epoch_cnt,</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>                                             epochs<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>                                             validation_data<span class="op">=</span>val_gen, </span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>                                             validation_steps<span class="op">=</span>val_steps_cnt,</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>                                             callbacks<span class="op">=</span>callbacks_list_lstm6432, verbose<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/50
20/20 [==============================] - 2s 83ms/step - loss: 0.2134

Epoch 00001: val_loss improved from inf to 0.21343, saving model to clark_best_lstm6432.hdf5
 - 52s - loss: 0.4166 - val_loss: 0.2134
Epoch 2/50
20/20 [==============================] - 1s 65ms/step - loss: 0.2394

Epoch 00002: val_loss did not improve from 0.21343
 - 38s - loss: 0.2592 - val_loss: 0.2394
Epoch 3/50
20/20 [==============================] - 1s 73ms/step - loss: 0.2154

Epoch 00003: val_loss did not improve from 0.21343
 - 38s - loss: 0.2145 - val_loss: 0.2154
Epoch 4/50
20/20 [==============================] - 1s 63ms/step - loss: 0.2356

Epoch 00004: val_loss did not improve from 0.21343
 - 37s - loss: 0.1888 - val_loss: 0.2356
Epoch 5/50
20/20 [==============================] - 1s 65ms/step - loss: 0.2106

Epoch 00005: val_loss improved from 0.21343 to 0.21064, saving model to clark_best_lstm6432.hdf5
 - 37s - loss: 0.1734 - val_loss: 0.2106
Epoch 6/50
20/20 [==============================] - 1s 64ms/step - loss: 0.2121

Epoch 00006: val_loss did not improve from 0.21064
 - 37s - loss: 0.1678 - val_loss: 0.2121
Epoch 7/50
20/20 [==============================] - 1s 65ms/step - loss: 0.1950

Epoch 00007: val_loss improved from 0.21064 to 0.19502, saving model to clark_best_lstm6432.hdf5
 - 37s - loss: 0.1602 - val_loss: 0.1950
Epoch 8/50
20/20 [==============================] - 1s 64ms/step - loss: 0.2112

Epoch 00008: val_loss did not improve from 0.19502
 - 38s - loss: 0.1505 - val_loss: 0.2112
Epoch 9/50
20/20 [==============================] - 1s 67ms/step - loss: 0.2117

Epoch 00009: val_loss did not improve from 0.19502
 - 38s - loss: 0.1454 - val_loss: 0.2117
Epoch 10/50
20/20 [==============================] - 1s 66ms/step - loss: 0.2128

Epoch 00010: val_loss did not improve from 0.19502
 - 37s - loss: 0.1427 - val_loss: 0.2128
Epoch 11/50
20/20 [==============================] - 1s 65ms/step - loss: 0.2147

Epoch 00011: val_loss did not improve from 0.19502
 - 39s - loss: 0.1397 - val_loss: 0.2147
Epoch 12/50
20/20 [==============================] - 1s 64ms/step - loss: 0.1968

Epoch 00012: val_loss did not improve from 0.19502
 - 38s - loss: 0.1353 - val_loss: 0.1968
Epoch 13/50
20/20 [==============================] - 1s 71ms/step - loss: 0.2072

Epoch 00013: val_loss did not improve from 0.19502
 - 38s - loss: 0.1296 - val_loss: 0.2072
Epoch 14/50
20/20 [==============================] - 1s 67ms/step - loss: 0.1979

Epoch 00014: val_loss did not improve from 0.19502
 - 39s - loss: 0.1283 - val_loss: 0.1979
Epoch 15/50
20/20 [==============================] - 1s 67ms/step - loss: 0.2203

Epoch 00015: val_loss did not improve from 0.19502
 - 39s - loss: 0.1231 - val_loss: 0.2203
Epoch 16/50
20/20 [==============================] - 1s 67ms/step - loss: 0.1974

Epoch 00016: val_loss did not improve from 0.19502
 - 39s - loss: 0.1256 - val_loss: 0.1974
Epoch 17/50
20/20 [==============================] - 1s 65ms/step - loss: 0.2095

Epoch 00017: val_loss did not improve from 0.19502
 - 39s - loss: 0.1221 - val_loss: 0.2095
Epoch 00017: early stopping</code></pre>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:30:50.433944Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:30:50.213487Z&quot;}" data-execution_count="37">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>loss_lstm6432 <span class="op">=</span> history_lstm6432.history[<span class="st">'loss'</span>]</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>val_loss_lstm6432 <span class="op">=</span> history_lstm6432.history[<span class="st">'val_loss'</span>]</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(loss_lstm6432) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs, loss_lstm6432, <span class="st">'bo'</span>, label<span class="op">=</span><span class="st">'Training loss'</span>)</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs, val_loss_lstm6432, <span class="st">'b'</span>, label<span class="op">=</span><span class="st">'Validation loss'</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Training and validation loss'</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="[DL] HERE Comes the Sun-SUBIC (Indiv - Yu,J)_files/figure-html/cell-34-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:30:50.439598Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:30:50.435812Z&quot;}" data-execution_count="38">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Model Error:'</span>, <span class="ss">f'</span><span class="sc">{</span>((<span class="bu">min</span>(val_loss_lstm6432) <span class="op">*</span> train_mw_std)<span class="op">/</span>plant_capacity)<span class="sc">:0.2%}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model Error: 1.41%</code></pre>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:30:50.444773Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:30:50.441616Z&quot;}" data-execution_count="39">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>lstm6432 <span class="op">=</span> ((<span class="bu">min</span>(val_loss_lstm6432) <span class="op">*</span> train_mw_std)<span class="op">/</span>plant_capacity) <span class="op">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="lstm4">
<div style="padding:20px;">
<font style="font-weight:bold;font-size:15px;color:#2c3393;">2.5.4 Stacked LSTM with 32 and 64 nodes</font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:41:42.935103Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:30:50.446701Z&quot;}" data-execution_count="40">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>filepath_lstm3264 <span class="op">=</span><span class="st">"clark_best_lstm3264.hdf5"</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>cp_lstm3264 <span class="op">=</span> ModelCheckpoint(filepath_lstm3264, monitor<span class="op">=</span><span class="st">'val_loss'</span>, verbose<span class="op">=</span><span class="dv">2</span>, save_best_only<span class="op">=</span><span class="va">True</span>, mode<span class="op">=</span><span class="st">'min'</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>es_lstm3264 <span class="op">=</span> EarlyStopping(monitor<span class="op">=</span><span class="st">'val_loss'</span>, mode<span class="op">=</span><span class="st">'min'</span>, verbose<span class="op">=</span><span class="dv">2</span>, patience<span class="op">=</span><span class="dv">10</span>, min_delta<span class="op">=</span><span class="fl">.01</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>callbacks_list_lstm3264 <span class="op">=</span> [cp_lstm3264, es_lstm3264]</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co"># fix random seed for reproducibility</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>seed <span class="op">=</span> <span class="dv">1337</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>np.random.seed(seed)</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>model_lstm3264 <span class="op">=</span> Sequential()</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>model_lstm3264.add(layers.LSTM(<span class="dv">64</span>,</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>                    dropout<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>                    recurrent_dropout<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>                    return_sequences<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>                    input_shape<span class="op">=</span>(<span class="va">None</span>, float_data.shape[<span class="op">-</span><span class="dv">1</span>])))</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>model_lstm3264.add(layers.LSTM(<span class="dv">32</span>,</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>                    dropout<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>                    recurrent_dropout<span class="op">=</span><span class="fl">0.2</span>))</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>model_lstm3264.add(layers.Dense(<span class="dv">64</span>, activation<span class="op">=</span><span class="st">'relu'</span>))</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>model_lstm3264.add(layers.Dense(<span class="dv">1</span>))</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>model_lstm3264.<span class="bu">compile</span>(optimizer<span class="op">=</span>RMSprop(), loss<span class="op">=</span><span class="st">'mae'</span>)</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>history_lstm3264 <span class="op">=</span> model_lstm3264.fit_generator(train_gen,</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>                                             steps_per_epoch<span class="op">=</span>steps_per_epoch_cnt,</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a>                                             epochs<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>                                             validation_data<span class="op">=</span>val_gen, </span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>                                             validation_steps<span class="op">=</span>val_steps_cnt,</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>                                             callbacks<span class="op">=</span>callbacks_list_lstm3264, verbose<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Epoch 1/50
20/20 [==============================] - 2s 78ms/step - loss: 0.2272

Epoch 00001: val_loss improved from inf to 0.22722, saving model to clark_best_lstm3264.hdf5
 - 41s - loss: 0.4076 - val_loss: 0.2272
Epoch 2/50
20/20 [==============================] - 2s 75ms/step - loss: 0.2298

Epoch 00002: val_loss did not improve from 0.22722
 - 39s - loss: 0.2578 - val_loss: 0.2298
Epoch 3/50
20/20 [==============================] - 1s 66ms/step - loss: 0.2099

Epoch 00003: val_loss improved from 0.22722 to 0.20986, saving model to clark_best_lstm3264.hdf5
 - 41s - loss: 0.2111 - val_loss: 0.2099
Epoch 4/50
20/20 [==============================] - 1s 66ms/step - loss: 0.2387

Epoch 00004: val_loss did not improve from 0.20986
 - 37s - loss: 0.1871 - val_loss: 0.2387
Epoch 5/50
20/20 [==============================] - 1s 65ms/step - loss: 0.2111

Epoch 00005: val_loss did not improve from 0.20986
 - 37s - loss: 0.1708 - val_loss: 0.2111
Epoch 6/50
20/20 [==============================] - 1s 67ms/step - loss: 0.2193

Epoch 00006: val_loss did not improve from 0.20986
 - 37s - loss: 0.1655 - val_loss: 0.2193
Epoch 7/50
20/20 [==============================] - 1s 67ms/step - loss: 0.1926

Epoch 00007: val_loss improved from 0.20986 to 0.19259, saving model to clark_best_lstm3264.hdf5
 - 38s - loss: 0.1579 - val_loss: 0.1926
Epoch 8/50
20/20 [==============================] - 1s 68ms/step - loss: 0.2260

Epoch 00008: val_loss did not improve from 0.19259
 - 38s - loss: 0.1513 - val_loss: 0.2260
Epoch 9/50
20/20 [==============================] - 1s 67ms/step - loss: 0.2203

Epoch 00009: val_loss did not improve from 0.19259
 - 39s - loss: 0.1417 - val_loss: 0.2203
Epoch 10/50
20/20 [==============================] - 1s 67ms/step - loss: 0.2130

Epoch 00010: val_loss did not improve from 0.19259
 - 37s - loss: 0.1421 - val_loss: 0.2130
Epoch 11/50
20/20 [==============================] - 1s 65ms/step - loss: 0.2420

Epoch 00011: val_loss did not improve from 0.19259
 - 37s - loss: 0.1376 - val_loss: 0.2420
Epoch 12/50
20/20 [==============================] - 1s 68ms/step - loss: 0.1928

Epoch 00012: val_loss did not improve from 0.19259
 - 38s - loss: 0.1358 - val_loss: 0.1928
Epoch 13/50
20/20 [==============================] - 1s 66ms/step - loss: 0.2139

Epoch 00013: val_loss did not improve from 0.19259
 - 38s - loss: 0.1290 - val_loss: 0.2139
Epoch 14/50
20/20 [==============================] - 1s 66ms/step - loss: 0.1976

Epoch 00014: val_loss did not improve from 0.19259
 - 38s - loss: 0.1270 - val_loss: 0.1976
Epoch 15/50
20/20 [==============================] - 1s 66ms/step - loss: 0.2421

Epoch 00015: val_loss did not improve from 0.19259
 - 38s - loss: 0.1227 - val_loss: 0.2421
Epoch 16/50
20/20 [==============================] - 1s 68ms/step - loss: 0.2069

Epoch 00016: val_loss did not improve from 0.19259
 - 38s - loss: 0.1243 - val_loss: 0.2069
Epoch 17/50
20/20 [==============================] - 1s 66ms/step - loss: 0.2055

Epoch 00017: val_loss did not improve from 0.19259
 - 37s - loss: 0.1201 - val_loss: 0.2055
Epoch 00017: early stopping</code></pre>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:41:43.144255Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:41:42.936638Z&quot;}" data-execution_count="41">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>loss_lstm3264 <span class="op">=</span> history_lstm3264.history[<span class="st">'loss'</span>]</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>val_loss_lstm3264 <span class="op">=</span> history_lstm3264.history[<span class="st">'val_loss'</span>]</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>epochs <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(loss_lstm3264) <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>plt.figure()</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs, loss_lstm3264, <span class="st">'bo'</span>, label<span class="op">=</span><span class="st">'Training loss'</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>plt.plot(epochs, val_loss_lstm3264, <span class="st">'b'</span>, label<span class="op">=</span><span class="st">'Validation loss'</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Training and validation loss'</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="[DL] HERE Comes the Sun-SUBIC (Indiv - Yu,J)_files/figure-html/cell-38-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:41:43.150064Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:41:43.145864Z&quot;}" data-execution_count="42">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Model Error:'</span>, <span class="ss">f'</span><span class="sc">{</span>((<span class="bu">min</span>(val_loss_lstm3264) <span class="op">*</span> train_mw_std)<span class="op">/</span>plant_capacity)<span class="sc">:0.2%}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model Error: 1.40%</code></pre>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:41:43.154532Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:41:43.151940Z&quot;}" data-execution_count="43">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>lstm3264 <span class="op">=</span> ((<span class="bu">min</span>(val_loss_lstm3264) <span class="op">*</span> train_mw_std)<span class="op">/</span>plant_capacity)  <span class="op">*</span> <span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="results">
<div style="padding:3px;">
<font style="font-weight:bold;font-size:20px;color:#2c3393;">3. Results and Discussions</font>
</div>
<div id="res">
<div style="padding:10px;">
<font style="font-weight:bold;font-size:15px;color:#2c3393;">3.1 Results</font>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:41:43.159244Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:41:43.156020Z&quot;}" data-execution_count="44">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>names <span class="op">=</span> [<span class="st">'Industry Agnostic Naive Method'</span>,</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>         <span class="st">'Industry Standard Naive Method'</span>, </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">'LSTM with 64 nodes'</span>,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">'LSTM with 32 nodes'</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">'LSTM+LSTM with 64 nodes and 32 nodes'</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">'LSTM+LSTM with 32 nodes and 64 nodes'</span>]</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> [benchmark1, </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>           benchmark2,</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>           lstm64,</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>           lstm32,</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>           lstm6432,</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>           lstm3264]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-20T19:41:43.164874Z&quot;,&quot;start_time&quot;:&quot;2019-12-20T19:41:43.160798Z&quot;}" data-execution_count="45">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> pd.DataFrame(<span class="bu">zip</span>(names,results), columns<span class="op">=</span>[<span class="st">'Model'</span>, <span class="st">'Error in Percentage'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-21T02:43:34.909019Z&quot;,&quot;start_time&quot;:&quot;2019-12-21T02:43:34.905769Z&quot;}" data-execution_count="47">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>results[<span class="st">'Error in Percentage'</span>] <span class="op">=</span> <span class="bu">round</span>(results[<span class="st">'Error in Percentage'</span>],<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-21T02:43:42.897120Z&quot;,&quot;start_time&quot;:&quot;2019-12-21T02:43:42.890993Z&quot;}" data-execution_count="48">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>results[<span class="st">'Improvement'</span>] <span class="op">=</span> <span class="bu">round</span>(<span class="dv">1</span><span class="op">-</span>(results[<span class="st">'Error in Percentage'</span>]<span class="op">/</span><span class="fl">3.64</span>),<span class="dv">4</span>)<span class="op">*</span><span class="dv">100</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2019-12-21T02:43:51.071919Z&quot;,&quot;start_time&quot;:&quot;2019-12-21T02:43:51.055743Z&quot;}" data-execution_count="49">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Model</th>
<th data-quarto-table-cell-role="th">Error in Percentage</th>
<th data-quarto-table-cell-role="th">Improvement</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Industry Agnostic Naive Method</td>
<td>8.87</td>
<td>143.68</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Industry Standard Naive Method</td>
<td>3.64</td>
<td>0.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>LSTM with 64 nodes</td>
<td>1.44</td>
<td>60.44</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>LSTM with 32 nodes</td>
<td>1.36</td>
<td>62.64</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>LSTM+LSTM with 64 nodes and 32 nodes</td>
<td>1.41</td>
<td>61.26</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>LSTM+LSTM with 32 nodes and 64 nodes</td>
<td>1.40</td>
<td>61.54</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="res">
<div style="padding:10px;">
<font style="font-weight:bold;font-size:15px;color:#2c3393;">3.2 Discussion and Recommendation</font>
</div>
<p>Deep learning models, particularly Long-Short Term Memory, works very well with time series data that all neural networks performed more than 60% better than current industry standards. This improvements will save companies and the national grid operators money and make our power system more efficient. Companies will pay less paid due to miscalculations of projected generation and waste from generating too much power that are not bought by the market. Grid operators will save on repairs and downtimes caused by fluctuations in the power supply.</p>
<p>Further improvements in the model can be achieved further manipulation of the architecture of the network such as trying different numbers of nodes, layers, and optimizers in the LSTM layer, adding dense layers with different nodes, or even adding a CNN layer after the LSTM layer, as some have done. Another avenue for improvement is to obtain more data that are more indicative of solar power generation such as quality of solar panels, the angle they are placed, the irridiance per hour, altitude of the area, among others.</p>
<div id="summary">
<div style="padding:3px;">
<font style="font-weight:bold;font-size:20px;color:#2c3393;">4. Main Learning Points</font>
</div>
<p>In this age of the 4th industrial revolution, technologies are making everything, even ones that require specialized technical knowledge, such as programming, available to all. Various programs enable anyone, who has a computer, internet connection, and interest, to create their own machine learning models. All these parameter tuning, model selection, and model evaluation are getting simpler and simpler to execute, but harder to explain. This is where a formal education in data science with good mathematical foundation brings an edge. Real self-respecting data scientists will be able to explain not just how to execute/program the pipline, but also how the actual algorithm works and how it was able to provide the results it did. There is a developed intuition from having understand the fundamentals. This, together with industry expertise, will determine the success of a data scientist in the field.</p>
<p>Industry expertise is still important, as there are various intricacies in an industry that are not known to outsiders. These insights might be the determining factor in the increased performance of a model, or even its acceptance.</p>



</div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>