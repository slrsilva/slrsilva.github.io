<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-04-17">
<meta name="description" content="Looks like voting in the Philippines is all about location, location, location! Literacy and religion may not be factors, but hometown pride definitely is.">

<title>Sandro Luis R. Silva - Regional Voting Preferences in the 2019 Philippine Senatorial Elections</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/profile.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-9FYFKWYLVG"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-9FYFKWYLVG', { 'anonymize_ip': true});
</script>
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-9FYFKWYLVG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9FYFKWYLVG');
</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../custom-styles.scss">
<link rel="stylesheet" href="custom-styles.scss">
<meta name="twitter:title" content="Sandro Luis R. Silva - Regional Voting Preferences in the 2019 Philippine Senatorial Elections">
<meta name="twitter:description" content="Looks like voting in the Philippines is all about location, location, location! Literacy and religion may not be factors, but hometown pride definitely is.">
<meta name="twitter:image" content="thumbnail.jpeg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Sandro Luis R. Silva</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html" rel="" target="">
 <span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resume.html" rel="" target="">
 <span class="menu-text">Resume</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Regional Voting Preferences in the 2019 Philippine Senatorial Elections</h1>
                  <div>
        <div class="description">
          Looks like voting in the Philippines is all about location, location, location! Literacy and religion may not be factors, but hometown pride definitely is.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">python</div>
                <div class="quarto-category">EDA</div>
                <div class="quarto-category">geospatial</div>
                <div class="quarto-category">analysis</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 17, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-9FYFKWYLVG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9FYFKWYLVG');
</script>




<!-- <h4>Looks like voting in the Philippines is all about location, location, location! Literacy and religion may not be factors, but hometown pride definitely is.</h4> -->
<p><img src="thumbnail.jpeg" class="img-fluid"></p>
<h1>
Overview
</h1>
<p>Original creation and submission for this notebook was last May 29, 2019.</p>
<p>This jupyter notebook was created for my Data Mining and Wrangling class for my Masters in Data Science program in the Asian Institute of Management. In particular, this was done during the 2nd semester for a class - Data Mining and Wrangling - as one of the core requirements. In this report, we shall explore and understand the results of the 2019 elections through descriptive statistics. We shall show some exploratory data analysis on the following questions: <br></p>
<ol>
<li>
How did the various administrative regions of the Philippines voted for their senators?
</li><li>
Is the voter preference homogeneous across the country, or is there a preferred candidate or party per region? More specifically, how does (1) religious affiliation, (2) educational attainment, and (2) sex play a major role on how the voters select their candidates.
</li></ol>
<h1>
Acknowledgements
</h1>
This analysis was done together with my Lab partner, George Esleta. I would like to thank Prof Christian Alis and the ACCeSS Laboratory for the access to the high-performance computing facility.
<h2 class="anchored">
Methodology
</h2>
<h3 class="anchored">
Pre-requisites: Load Requirement Package
</h3>
<p>Before anything else, let us first load all important modules for this exercise.</p>
<div class="cell" data-execution_count="1">
<details>
<summary>Loading required modules</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> io</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> urllib.request</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> LinearSegmentedColormap</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>It is important to identify the datasets we are going to use for this exercise. The two identified datasets the group intends to use are: the 2019 National Data and the 2015-2016 Census data.</p>
<p>With regards to 2019 National data, the team used a web scapper provided Prof.&nbsp;Alis. The web scapper downloaded the election results from the Commission of Elections’ 2019 National and Local Elections website. The results were then stored in a local repository which is then easily accesible for the team. The 2019 elections results are broken down into two main directories: results and contest. In this exercise, the team will explore both directories to map out a comprehensive summary of the 2019 senatorial and party elections.</p>
<p>Secondly, the 2015-2016 Census data has already been stored in a local repository for easier access. One of the main reasons why the team decided to use the 2015-2016 Census data is because of the lack of availability of recent data. The Philippine Statistics Authority only releases a comprehensive census survey ever six years. However for the purpose of this exercise, the team has agreed that the 2015-2016 census data can act as an appproximate for today’s population.</p>
<h3 class="anchored">
Step 1: Extract and collect the 2019 Elections (Results) data
</h3>
<p>The first directory to explore is the 2019 Election <code>results</code>. The <code>results</code> directory contains all electoral results from a regional level down to the barangay level. For each level, a specific <code>coc.json</code> file is stored. This file contains all electoral results data and metadata for both national and local elections. However for the purposes of this analysis, we will only look at the aggregated elections data at the regional level. The files that we are interested are the coc.json files associated to each province, as these files contain the metadata and data on the election results.</p>
<p>The main structure of each coc.json file contains the following main keys: <code>vbc</code>, <code>rs</code>, <code>sts</code>, <code>obs</code>, and <code>cos</code>. For the purpose of this exercise, the important key the group needs to extract is the <code>rs</code> key as this provides the each candidate’s total votes per area. Under the <code>rs</code> key, the following keys can be found: <code>cc</code>, <code>bo</code>, <code>v</code>, <code>tot</code>, <code>per</code>, and <code>ser</code>. Cross referencing these keys with official statements and comelec documentations suggests that important keys are as follows: <code>cc</code> pertaining to contest_type, <code>bo</code> pertaining to the candidate_id, and <code>v</code> pertaining to votes_per_province.</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">Paremeter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">cc</td>
<td>Contestant Code</td>
</tr>
<tr class="even">
<td style="text-align: left;">bo</td>
<td>Contestant ID</td>
</tr>
<tr class="odd">
<td style="text-align: left;">v</td>
<td>Total Votes Per Contestant</td>
</tr>
<tr class="even">
<td style="text-align: left;">tot</td>
<td>Total Votes Per Province</td>
</tr>
</tbody>
</table>
<p>However, it must be pointed out that the available data only goes as high as provincial data. If we want to process the provincial level, the team will have to aggregate the data up.</p>
<p>The group created utility functions for easier retrieval of the provincial elections datasets. The purpose for the utility functions (and future utility functions) are for initial cleaning and manipulations. This is to ensure each dataset is ready for aggregation.</p>
<p>The <code>get_province_coc</code> method unpacks each key and value from the <code>coc.json</code> dictionary into a cleaned up dataframe. In addition, the method identifies which region and province the file originated from by examining the filepath that was passed.</p>
<p>The <code>get_all_province_coc</code> method is a walker that goes through each of the results directory. The walker checks if the filename has an equal value to <code>coc.json</code>. If a <code>coc.json</code>was located, the <code>get_province_coc</code> method is applied with the filepath as the parameter. The resulting dataframe is then appended to a master dataframe for further extraction and analysis. For this exercise, the group only had to extract data up to the regional and provincial levels so only three wildcard were use for the <code>glob</code> walker.</p>
<p>Special methods (<code>get_ncr_coc</code> and <code>get_all_ncr_coc</code>) were established to get the cities’ <code>coc.json</code>. For the case of the NCR cities, theire associated <code>coc.json</code> files were one directory lower.</p>
<h4 class="anchored">
</h4>
<div class="cell" data-execution_count="2">
<details>
<summary>Function for get_province_coc()</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_province_coc(filepath):</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Loads a single coc file. </span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Adds additional columns `region` and `province to the DataFrame,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">    depending on filepath.</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">    filepath    : filepath</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Return</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">    ------</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">    df          : a dataframe</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> []</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        dirpath, filepath <span class="op">=</span> os.path.split(filepath)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        region <span class="op">=</span> dirpath.split(<span class="st">'/'</span>)[<span class="op">-</span><span class="dv">2</span>]</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        province <span class="op">=</span> dirpath.split(<span class="st">'/'</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> json.load(f)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> each <span class="kw">in</span> data[<span class="st">'rs'</span>]:</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>            row <span class="op">=</span> [<span class="bu">float</span>(element) <span class="cf">for</span> element <span class="kw">in</span> <span class="bu">list</span>(each.values())]</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>            output.append([data[<span class="st">'vbc'</span>]] <span class="op">+</span> row <span class="op">+</span> [region] <span class="op">+</span> [province])</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(output,</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>                      columns<span class="op">=</span>[<span class="st">'vbc'</span>, <span class="st">'cc'</span>, <span class="st">'bo'</span>, <span class="st">'v'</span>, <span class="st">'tot'</span>, <span class="st">'per'</span>, <span class="st">'ser'</span>,</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'region'</span>, <span class="st">'province'</span>])</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="3">
<details>
<summary>Function for get_all_province_coc()</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_all_province_coc(tree):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Loads all province COC files and saves them to a dataframe</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Checks the filepath if filename is 'coc.json'</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Created a new column to deal with the reclassification of</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">        "NEGROS ORIENTAL" and "NEGROS OCCIDENTAL" to "NIR" </span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">            to match the PSA 2016 dataset.</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">    filepath    : filepath</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Return</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">    ------</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">    df          : a dataframe</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> pd.DataFrame()</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> glob.glob(tree):</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> os.path.basename(<span class="bu">file</span>) <span class="op">==</span> <span class="st">'coc.json'</span>:</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>            df <span class="op">=</span> get_province_coc(<span class="bu">file</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>            total <span class="op">=</span> total.append(df)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    total.rename(columns<span class="op">=</span>{<span class="st">'region'</span>: <span class="st">'region_raw'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    total[<span class="st">'region'</span>] <span class="op">=</span> total[<span class="st">'region_raw'</span>].copy()</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    total.loc[(total[<span class="st">'province'</span>] <span class="op">==</span> <span class="st">"NEGROS ORIENTAL"</span>) <span class="op">|</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>              (total[<span class="st">'province'</span>] <span class="op">==</span> <span class="st">"NEGROS OCCIDENTAL"</span>), <span class="st">'region'</span>] <span class="op">=</span> <span class="st">'NIR'</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="4">
<details>
<summary>Function for get_ncr_coc()</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_ncr_coc(filepath):</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Loads a single coc file. </span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Adds additional columns `region` and `province to the DataFrame,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">    depending on filepath.</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">    filepath    : filepath</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Return</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">    ------</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">    df          : a dataframe    </span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> []</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        dirpath, filepath <span class="op">=</span> os.path.split(filepath)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        region <span class="op">=</span> dirpath.split(<span class="st">'/'</span>)[<span class="op">-</span><span class="dv">3</span>]</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        province <span class="op">=</span> dirpath.split(<span class="st">'/'</span>)[<span class="op">-</span><span class="dv">2</span>]</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> json.load(f)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> each <span class="kw">in</span> data[<span class="st">'rs'</span>]:</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>            row <span class="op">=</span> [<span class="bu">float</span>(element) <span class="cf">for</span> element <span class="kw">in</span> <span class="bu">list</span>(each.values())]</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>            output.append([data[<span class="st">'vbc'</span>]] <span class="op">+</span> row <span class="op">+</span> [region] <span class="op">+</span> [province])</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(output,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                      columns<span class="op">=</span>[<span class="st">'vbc'</span>, <span class="st">'cc'</span>, <span class="st">'bo'</span>, <span class="st">'v'</span>, <span class="st">'tot'</span>, <span class="st">'per'</span>, <span class="st">'ser'</span>,</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'region'</span>, <span class="st">'province'</span>])</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="5">
<details>
<summary>Function for get_all_ncr_coc()</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_all_ncr_coc(tree):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Loads all province COC files and saves them to a dataframe</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Checks the filepath if filename is 'coc.json'</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">    filepath    : filepath</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Return</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">    ------</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">    df          : a dataframe</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> pd.DataFrame()</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> glob.glob(tree):</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.split(<span class="st">'/'</span>)[<span class="dv">7</span>] <span class="op">==</span> <span class="st">'NCR'</span>:</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> os.path.basename(<span class="bu">file</span>) <span class="op">==</span> <span class="st">'coc.json'</span>:</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                df <span class="op">=</span> get_ncr_coc(<span class="bu">file</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                total <span class="op">=</span> total.append(df)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    total.rename(columns<span class="op">=</span>{<span class="st">'region'</span>: <span class="st">'region_raw'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    total[<span class="st">'region'</span>] <span class="op">=</span> total[<span class="st">'region_raw'</span>].copy()</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="with-these-utility-functions-inplace-the-team-can-now-apply-these-methods-for-easier-access-to-the-2019-elections-data." class="level4">
<h4 class="anchored" data-anchor-id="with-these-utility-functions-inplace-the-team-can-now-apply-these-methods-for-easier-access-to-the-2019-elections-data.">With these utility functions inplace, the team can now apply these methods for easier access to the 2019 elections data.</h4>
<p>We can now compile all of the election results with the following line:</p>
<div class="cell" data-execution_count="6">
<details>
<summary>Compiling provinces data with NCR data</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>tree <span class="op">=</span> <span class="st">'/mnt/data/public/elections/nle2019/results/*/*/*'</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ncr_tree <span class="op">=</span> <span class="st">'/mnt/data/public/elections/nle2019/results/*/*/*/*'</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>df_results <span class="op">=</span> get_all_province_coc(tree)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>df_results <span class="op">=</span> df_results.append(get_all_ncr_coc(ncr_tree))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>df_results.drop_duplicates(inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s see what we have:</p>
<table class="table">
<colgroup>
<col style="width: 5%">
<col style="width: 10%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 5%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">vbc</th>
<th>cc</th>
<th>bo</th>
<th>v</th>
<th>tot</th>
<th>per</th>
<th>ser</th>
<th>region_raw</th>
<th>province</th>
<th>region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td>89550</td>
<td>1.0</td>
<td>1.0</td>
<td>2004.0</td>
<td>1708769.0</td>
<td>0.11</td>
<td>2800.0</td>
<td>REGION I</td>
<td>ILOCOS NORTE</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td>89550</td>
<td>1.0</td>
<td>2.0</td>
<td>1607.0</td>
<td>1708769.0</td>
<td>0.09</td>
<td>2800.0</td>
<td>REGION I</td>
<td>ILOCOS NORTE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td>89550</td>
<td>1.0</td>
<td>3.0</td>
<td>8772.0</td>
<td>1708769.0</td>
<td>0.51</td>
<td>2800.0</td>
<td>REGION I</td>
<td>ILOCOS NORTE</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td>89550</td>
<td>1.0</td>
<td>4.0</td>
<td>1767.0</td>
<td>1708769.0</td>
<td>0.10</td>
<td>2800.0</td>
<td>REGION I</td>
<td>ILOCOS NORTE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td>89550</td>
<td>1.0</td>
<td>5.0</td>
<td>5068.0</td>
<td>1708769.0</td>
<td>0.29</td>
<td>2800.0</td>
<td>REGION I</td>
<td>ILOCOS NORTE</td>
</tr>
</tbody>
</table>
</section>
<section id="next-let-us-examine-the-obtained-dataset-with-actual-election-results." class="level3">
<h3 class="anchored">Next, let us examine the obtained dataset with actual election results.</h3>
<p>By cross checking the results with <a href="https://www.comelec.gov.ph/?r=2019NLE/ListsOfCandidates/CertifiedListofCandidates">Comelec data</a>, we can identify the senators and party names.</p>
<p>Just to check our data, we can look at an example senator from the dataset. By choosing <code>cc=1</code> and <code>bo=46</code>, we are actually highlighting Imee Marcos’ senatorial candidacy results.</p>
<div class="cell" data-execution_count="7">
<details>
<summary>Code of creating a bar graph for Imee Marcos highest voting province in ascending order</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Votes'</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>df_marcos <span class="op">=</span> df_results.query(<span class="st">'cc == 1 &amp; bo == 46'</span>).copy()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>df_marcos.groupby(<span class="st">'region'</span>).<span class="bu">sum</span>()[<span class="st">'v'</span>].sort_values(</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ascending<span class="op">=</span><span class="va">True</span>).plot.barh(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                              title<span class="op">=</span><span class="st">'Contestant: 46 - Imee Marcos'</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                              color<span class="op">=</span><span class="st">'#BF5209'</span>, ax<span class="op">=</span>ax)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image1.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">FIGURE: Total Votes for Imee Marcos by Region</figcaption><p></p>
</figure>
</div>
<p>Additionally, let us check some descriptive statistics for the 2019 Elections dataset. More specifically, let us examine the <code>v</code> or <code>votes</code> column. The group will be highly dependent on the <code>votes</code> data so let us first do some initial statistics and visualizations.</p>
<div class="cell" data-execution_count="8">
<details>
<summary>Code to groupby sum up by region and province</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df_regions <span class="op">=</span> df_results.groupby([<span class="st">'region'</span>, <span class="st">'province'</span>])[<span class="st">'v'</span>].<span class="bu">sum</span>().to_frame()</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df_regions <span class="op">=</span> df_regions.rename(columns<span class="op">=</span>{<span class="st">'v'</span>: <span class="st">'votes'</span>})</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>df_regions.head(<span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: left;">region</th>
<th>province</th>
<th>votes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">BARMM</td>
<td>BASILAN</td>
<td>2093067.0</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td>LANAO DEL SUR</td>
<td>4770462.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td>MAGUINDANAO</td>
<td>5917983.0</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td>SULU</td>
<td>3529555.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td>TAWI-TAWI</td>
<td>1874486.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">CAR</td>
<td>ABRA</td>
<td>1923481.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td>APAYAO</td>
<td>703002.0</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td>BENGUET</td>
<td>2426397.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td>IFUGAO</td>
<td>1408688.0</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td>KALINGA</td>
<td>1621414.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td>MOUNTAIN PROVINCE</td>
<td>1074249.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">NCR</td>
<td>NATIONAL CAPITAL REGION - FOURTH DISTRICT</td>
<td>22896771.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td>NATIONAL CAPITAL REGION - MANILA</td>
<td>13461229.0</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td>NATIONAL CAPITAL REGION - SECOND DISTRICT</td>
<td>29803007.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td>NATIONAL CAPITAL REGION - THIRD DISTRICT</td>
<td>18481014.0</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td>TAGUIG - PATEROS</td>
<td>10018306.0</td>
</tr>
</tbody>
</table>
<p>Just to explore, the code and image below shows the total votes in region 3. Notice that Bulacan has the highest number of votes, followed by Nueva Ecija, then Pampanga.</p>
<div class="cell" data-execution_count="9">
<details>
<summary>Code to plot summary for Region 3 total votes</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Votes'</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>df_test.loc[<span class="st">'REGION III'</span>,<span class="st">"votes"</span>].plot.barh(color<span class="op">=</span><span class="st">'#BF5209'</span>, ax<span class="op">=</span>ax)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="image2.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">FIGURE: Votes Distribution in Region III</figcaption><p></p>
</figure>
</div>
<p>Here we explore the vote distribution in the National Capital Region. The classification of district and cities were broken down by area (Manila, Taguig-Pateros, Second District, Third District, and Fourth District).The top number of votes came from the second district (mainly because of Quezon City), followed by the Fourth District, then the Third District.</p>
<div class="cell" data-execution_count="10">
<details>
<summary>Code to plot summary for NCR total votes</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Votes'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>df_test.loc[<span class="st">'NCQ'</span>,<span class="st">"votes"</span>].plot.barh(color<span class="op">=</span><span class="st">'#BF5209'</span>, ax<span class="op">=</span>ax)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="image3.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">FIGURE: Votes Distribution in the National Capital Region</figcaption><p></p>
</figure>
</div>
<p>Next, we explore the distribution of votes in Region 4-A. Unsurprisingly, the population of votes is high in the population centers of Cavite, then Batangas, then Laguna.</p>
<div class="cell" data-execution_count="11">
<details>
<summary>Code to plot summary for Region 4-A total votes</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Votes'</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>df_test.loc[<span class="st">'REGION IV-A'</span>,<span class="st">"votes"</span>].plot.barh(color<span class="op">=</span><span class="st">'#BF5209'</span>, ax<span class="op">=</span>ax)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="image4.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">FIGURE: Votes Distribution in the Region IV-A</figcaption><p></p>
</figure>
</div>
<p>For now, let us also examine the distribution of election votes in region 7. Unsurprisingly, the votes are concentrated first in Cebu, followed by Bohol and Siquijor.</p>
<div class="cell" data-execution_count="12">
<details>
<summary>Code to plot summary for Region 7 total votes</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Votes'</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>df_test.loc[<span class="st">'REGION VII'</span>,<span class="st">"votes"</span>].plot.barh(color<span class="op">=</span><span class="st">'#BF5209'</span>, ax<span class="op">=</span>ax)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="image5.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">FIGURE: Votes Distribution in the Region VII</figcaption><p></p>
</figure>
</div>
<p>To match the contestant ID to the contestant name, the <code>contest</code> files were also downloaded from the <a href="https://2019electionresults.comelec.gov.ph/#/dashboard">Commission of Elections’ 2019 National and Local Elections website</a> and stored in the local repository. Similar to the <code>results</code> directory, the <code>contest</code> directory contained json files for each contest type/position. Upon inspection of a sample file within the directory, the following values were obtained:</p>
<p>The pertinent keys from each json files were:</p>
<table class="table">
<thead>
<tr class="header">
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>cc</td>
<td>Contest code</td>
</tr>
<tr class="even">
<td>cn</td>
<td>Contest code name - location</td>
</tr>
<tr class="odd">
<td>ccc</td>
<td>Contest code name</td>
</tr>
<tr class="even">
<td>type</td>
<td>Contest type</td>
</tr>
<tr class="odd">
<td>bos</td>
<td>list of candidate parameters</td>
</tr>
</tbody>
</table>
<p>Under the <code>bos</code> key, we can extract each of the candidates’ parameters. The more useful ones for the group’s study include:</p>
<table class="table">
<thead>
<tr class="header">
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>boc</td>
<td>Contestant ID</td>
</tr>
<tr class="even">
<td>bon</td>
<td>Contestant Name</td>
</tr>
<tr class="odd">
<td>pn</td>
<td>Party Name</td>
</tr>
</tbody>
</table>
<h3 class="anchored">
Step 2: Extract and collect the 2019 Elections (Contestant) data
</h3>
<p>The group also created utility functions for easier retrieval of the contestant datasets. This is to ensure each dataset is ready for aggregation.</p>
<p>Similar to the <code>get_province_coc</code>, the <code>get_contestant_attrib</code> method unpacks each key and value from the <code>{contest_number}.json</code> dictionary into a cleaned up dataframe. The method converts the <code>bos</code> directory into an additional list, which will also be appended into the resulting dataframe.</p>
<p>There are two (2) major political coalitions fighting for the senate seats:</p>
<ol type="1">
<li>Hugpong ng Pagbabago (HNP)</li>
<li>Otso Diretso</li>
</ol>
<p>Similar to the <code>get_all_province_coc</code>, the <code>get_contestants_attrib</code> method is a walker that goes through each of the <code>contest</code> directory. The method will first append all <code>{contest_numer}.json</code> files into a singular dataframe. Next, the method creates a new column that identifies who among the senatorial candidates are part of the <strong>Hugpong ng Pagbabago (HNP)</strong> or <strong>Otso Diretso campaign</strong>.</p>
<div class="cell" data-execution_count="13">
<details>
<summary>Function for get_contestant_attrib()</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_contestant_attrib(filepath):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns the contestant json file into a dataframe</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">    filepath   : string</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">    df         : pd.DataFrame of contestnat attributes</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    contestants_values <span class="op">=</span> []</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(filepath, <span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> json.load(<span class="bu">file</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        attrib_keys <span class="op">=</span> [key <span class="cf">for</span> key <span class="kw">in</span> <span class="bu">list</span>(data.keys())</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                       <span class="cf">if</span> <span class="bu">isinstance</span>(key, (<span class="bu">str</span>, <span class="bu">float</span>, <span class="bu">int</span>))]</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>        attrib_values <span class="op">=</span> [value <span class="cf">for</span> value <span class="kw">in</span> <span class="bu">list</span>(data.values())</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>                         <span class="cf">if</span> <span class="bu">isinstance</span>(value, (<span class="bu">str</span>, <span class="bu">float</span>, <span class="bu">int</span>))]</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>        contest_values <span class="op">=</span> [<span class="bu">list</span>(contest.values()) <span class="cf">for</span> contest <span class="kw">in</span> data[<span class="st">'bos'</span>]]</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.DataFrame(contest_values,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>                          columns<span class="op">=</span><span class="bu">list</span>(data[<span class="st">'bos'</span>][<span class="dv">0</span>].keys()))</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k, v <span class="kw">in</span> <span class="bu">zip</span>(attrib_keys, attrib_values):</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>            df[k] <span class="op">=</span> v</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="14">
<details>
<summary>Function for get_contestants_attrib</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_contestants_attrib(filepath):</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns ALL contestant json files into a dataframe</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">    filepath   : string</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">    df         : pd.DataFrame of contestant attributes</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> each_filepath <span class="kw">in</span> glob.glob(filepath):</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.append(get_contestant_attrib(each_filepath))</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    senators <span class="op">=</span> df[df.cc <span class="op">==</span> <span class="dv">1</span>].copy()</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    senators[<span class="st">'bon'</span>] <span class="op">=</span> senators[<span class="st">'bon'</span>].<span class="bu">str</span>.extract(pat<span class="op">=</span><span class="st">'(.*?) \('</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    party <span class="op">=</span> df[df.cc <span class="op">==</span> <span class="dv">5567</span>].copy()</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> senators.append(party)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    df.drop_duplicates(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    df.rename(columns<span class="op">=</span>{<span class="st">'boc'</span>: <span class="st">'bo'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    otso <span class="op">=</span> [<span class="st">'AQUINO, BENIGNO BAM '</span>, <span class="st">'DIOKNO, CHEL'</span>, <span class="st">'HILBAY, PILO'</span>,</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">'MACALINTAL, MACAROMY'</span>, <span class="st">'GUTOC, SAMIRA'</span>, <span class="st">'ALEJANO, GARY'</span>,</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ROXAS, MAR'</span>, <span class="st">'TAÑADA,LORENZO ERIN TAPAT'</span>]</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    hnp <span class="op">=</span> [<span class="st">'ANGARA, EDGARDO SONNY'</span>, <span class="st">'BONG REVILLA, RAMON JR'</span>, <span class="st">'CAYETANO, PIA'</span>,</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>           <span class="st">'DELA ROSA, BATO'</span>, <span class="st">'EJERCITO, ESTRADA JV'</span>, <span class="st">'ESTRADA, JINGGOY'</span>,</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>           <span class="st">'GO, BONG GO'</span>, <span class="st">'MANGUDADATU, DONG'</span>, <span class="st">'MANICAD, JIGGY'</span>,</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>           <span class="st">'MARCOS, IMEE'</span>, <span class="st">'PIMENTEL, KOKO'</span>, <span class="st">'TOLENTINO, FRANCIS'</span>, </span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>           <span class="st">'VILLAR, CYNTHIA'</span>]</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> o <span class="kw">in</span> otso:</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>        df.loc[df.bon <span class="op">==</span> o, <span class="st">'coalition'</span>] <span class="op">=</span> <span class="st">"Otso Diretso"</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> h <span class="kw">in</span> hnp:</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>        df.loc[df.bon <span class="op">==</span> h, <span class="st">'coalition'</span>] <span class="op">=</span> <span class="st">"HNP"</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'coalition'</span>] <span class="op">=</span> df[<span class="st">'coalition'</span>].fillna(<span class="st">'None'</span>)</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let us run the <code>get_contestants_attrib</code>. This will be used later in the blog for our further analysis.</p>
<div class="cell" data-execution_count="15">
<details>
<summary>Executing get_contestants_attrib function</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>contestant_filepaths <span class="op">=</span> <span class="st">'/mnt/data/public/elections/nle2019/contests/*'</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df_contestants <span class="op">=</span> get_contestants_attrib(contestant_filepaths)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>df_contestants.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="table">
<table class="table">
<colgroup>
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">bo</th>
<th style="text-align: left;">bon</th>
<th style="text-align: left;">boi</th>
<th style="text-align: right;">to</th>
<th style="text-align: right;">pc</th>
<th style="text-align: left;">pn</th>
<th style="text-align: right;">pcc</th>
<th style="text-align: right;">pcy</th>
<th style="text-align: right;">pcm</th>
<th style="text-align: right;">pck</th>
<th style="text-align: left;">cc</th>
<th style="text-align: right;">cn</th>
<th style="text-align: left;">ccc</th>
<th style="text-align: right;">ccn</th>
<th style="text-align: left;">pre</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">coalition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">37</td>
<td style="text-align: left;">HILBAY, PILO</td>
<td style="text-align: left;">52.png</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">AKSYON DEMOKRATIKO</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">SENATOR PHILIPPINES</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">SENATOR</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">national</td>
<td style="text-align: left;">Otso Diretso</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: left;">ALUNAN, RAFFY</td>
<td style="text-align: left;">53.png</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">BAGUMBAYAN VOLUNTEERS FOR A NEW PHILIPPINES</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">SENATOR PHILIPPINES</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">SENATOR</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">national</td>
<td style="text-align: left;">None</td>
</tr>
<tr class="odd">
<td style="text-align: right;">14</td>
<td style="text-align: left;">BALDEVARONA, BALDE</td>
<td style="text-align: left;">35.png</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">7</td>
<td style="text-align: left;">FILIPINO FAMILY PARTY</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">SENATOR PHILIPPINES</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">SENATOR</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">national</td>
<td style="text-align: left;">None</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: left;">CASIÑO, TOTI</td>
<td style="text-align: left;">20.png</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">KATIPUNAN NG DEMOKRATIKONG PILIPINO(KDP)</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">SENATOR PHILIPPINES</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">SENATOR</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">national</td>
<td style="text-align: left;">None</td>
</tr>
<tr class="odd">
<td style="text-align: right;">21</td>
<td style="text-align: left;">CHONG, GLENN</td>
<td style="text-align: left;">61.png</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">KATIPUNAN NG DEMOKRATIKONG PILIPINO(KDP)</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">SENATOR PHILIPPINES</td>
<td style="text-align: left;">1</td>
<td style="text-align: right;">SENATOR</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">national</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
</div>
<p>We now have two dataframes: <code>df_results</code> containing the 2019 election results, and <code>df_contestants</code> containing the contestant information. These two dataframes can now be merged into a single dataframe. Let us also drop certain columns which we have deemed as unimportant.</p>
<div class="cell" data-execution_count="16">
<details>
<summary>Function for merge_comelec()</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> merge_comelec(results, contestants):</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Merge results dataframe with contestants dataframe</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">    results    : pd.DataFrame</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">    contestants: pd.DataFrame</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">    df         : pd.DataFrame of contestant attributes</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.merge(results, contestants, on<span class="op">=</span>[<span class="st">'bo'</span>, <span class="st">'cc'</span>], how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.drop([<span class="st">'vbc'</span>, <span class="st">'boi'</span>, <span class="st">'to'</span>, <span class="st">'pc'</span>, <span class="st">'pcc'</span>, <span class="st">'pcy'</span>, <span class="st">'pcm'</span>,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'pck'</span>, <span class="st">'ccc'</span>, <span class="st">'pre'</span>, <span class="st">'ser'</span>, <span class="st">'cn'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    df.columns <span class="op">=</span> [<span class="st">'position'</span>, <span class="st">'candidate_id'</span>, <span class="st">'votes_per_province'</span>,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'total_votes'</span>, <span class="st">'votes_in_pct'</span>, <span class="st">'region_raw'</span>, <span class="st">'province'</span>,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'region'</span>, <span class="st">'candidate_name'</span>, <span class="st">'party_name'</span>,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'contest_position'</span>, <span class="st">'contest_type'</span>, <span class="st">'coalition'</span>]</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s merge the tables, then just check the unique regions using the <code>unique</code> method.</p>
<div class="cell" data-execution_count="17">
<details>
<summary>Merging the results and contestants dataframes</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>nle2019 <span class="op">=</span> merge_comelec(df_results, df_contestants)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>nle2019.region.unique()</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>array([<span class="st">'REGION I'</span>, <span class="st">'REGION IV-B'</span>, <span class="st">'BARMM'</span>, <span class="st">'REGION II'</span>, <span class="st">'REGION III'</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>       <span class="st">'REGION V'</span>, <span class="st">'REGION VI'</span>, <span class="st">'NIR'</span>, <span class="st">'REGION VII'</span>, <span class="st">'REGION VIII'</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>       <span class="st">'REGION IX'</span>, <span class="st">'REGION X'</span>, <span class="st">'REGION XI'</span>, <span class="st">'REGION XII'</span>, <span class="st">'REGION XIII'</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>       <span class="st">'REGION IV-A'</span>, <span class="st">'CAR'</span>, <span class="st">'NCR'</span>], dtype<span class="op">=</span><span class="bu">object</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<h3 class="anchored">
Step 3: Load <code>Geopandas</code> for geospatial processing
</h3>
<h4 class="anchored">
Loading the geospatial data
</h4>
<p>The Philippines is composed of <strong>seventeen (17) administrative regions</strong>. We can use the <code>geopandas</code> module to manage and pre-process geospatial data.</p>
<p>Let us first load up a geopandas graph of the Philippines.</p>
<div class="cell" data-execution_count="18">
<details>
<summary>Code to plot a map of the Philippines</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">15</span>), frameon<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>ph0 <span class="op">=</span> gpd.GeoDataFrame.from_file(<span class="st">"ph_regions.shp"</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>ph0.plot(ax<span class="op">=</span>ax, cmap<span class="op">=</span><span class="st">'Greens'</span>, edgecolor<span class="op">=</span><span class="st">'#555555'</span>, k<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Regions of the Philippines'</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">'top'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">'right'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">'bottom'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>ax.spines[<span class="st">'left'</span>].set_visible(<span class="va">False</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ind, row <span class="kw">in</span> ph0.iterrows():</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    ax.text(row[<span class="st">"geometry"</span>].centroid.x, row[<span class="st">"geometry"</span>].centroid.y,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>            row[<span class="st">"region"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="image6-map.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">FIGURE: Map of the Philippines</figcaption><p></p>
</figure>
</div>
<h4 class="anchored">
Looking at Senatorial Results
</h4>
<p>Let us look at the senatorial candidates. Let us total up the votes by candidate and see the top 12 winners.</p>
<table class="table">
<thead>
<tr class="header">
<th>Index</th>
<th>Candidate</th>
<th>Votes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>61</td>
<td>VILLAR, CYNTHIA</td>
<td>23653546.0</td>
</tr>
<tr class="even">
<td>54</td>
<td>POE, GRACE</td>
<td>20877585.0</td>
</tr>
<tr class="odd">
<td>33</td>
<td>GO, BONG GO</td>
<td>18979132.0</td>
</tr>
<tr class="even">
<td>18</td>
<td>CAYETANO, PIA</td>
<td>18287782.0</td>
</tr>
<tr class="odd">
<td>23</td>
<td>DELA ROSA, BATO</td>
<td>17396249.0</td>
</tr>
<tr class="even">
<td>7</td>
<td>ANGARA, EDGARDO SONNY</td>
<td>16826634.0</td>
</tr>
<tr class="odd">
<td>39</td>
<td>LAPID, LITO</td>
<td>16181906.0</td>
</tr>
<tr class="even">
<td>45</td>
<td>MARCOS, IMEE</td>
<td>14735294.0</td>
</tr>
<tr class="odd">
<td>59</td>
<td>TOLENTINO, FRANCIS</td>
<td>14264142.0</td>
</tr>
<tr class="even">
<td>15</td>
<td>BONG REVILLA, RAMON JR</td>
<td>13899831.0</td>
</tr>
<tr class="odd">
<td>14</td>
<td>BINAY, NANCY</td>
<td>13864931.0</td>
</tr>
<tr class="even">
<td>53</td>
<td>PIMENTEL, KOKO</td>
<td>13529531.0</td>
</tr>
</tbody>
</table>
<p>Let’s visualize this with a plot:</p>
<div class="cell" data-execution_count="19">
<details>
<summary>Code to plot top senators by vote</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">8</span>))</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">14</span>})</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>df_senator.set_index(<span class="st">'Candidate'</span>).head(<span class="dv">12</span>).sort_values(</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    by<span class="op">=</span><span class="st">'Votes'</span>, ascending<span class="op">=</span><span class="va">True</span>).plot.barh(ax<span class="op">=</span>ax,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Top 12 Candidates, in Millions'</span>, color<span class="op">=</span><span class="st">'#BF5209'</span>, legend<span class="op">=</span><span class="va">False</span>)<span class="op">;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Total Votes'</span>)<span class="op">;</span>im</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="image7-top12.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">FIGURE:Top 12 senators by vote</figcaption><p></p>
</figure>
</div>
<h4 class="anchored">
Top Senator Per Region
</h4>
<p>We want to find out won across all the regions. If there is any bias for cetain candidates. Based on our findings, we can see that candidate Cynthia Villar won majority of the regions.</p>
<p>It is interesting to note that the top ranking senator for Ilocos Region (Region I) and the Cordillera Administrative Region (CAR) is <strong>Imee Marcos</strong>, which hails from that region. This confirms that there is a “Solid North”, and that support for the Marcoses still exists in that area.</p>
<p>For the Mindanao regions, the top candidate is <strong>Bong Go</strong>, former special assistant to President Duterte, who is from Mindanao.</p>
<p>These show that Philippine politics is <strong>very regional in nature</strong>. Voters will naturally support their hometown candidate, regardless of the issues surrounding that candidate.</p>
<div class="cell" data-execution_count="20">
<details>
<summary>Code to get top senator by region and the associated number of votes</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df_senator_region <span class="op">=</span> df_senators.groupby(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'region'</span>, <span class="st">'candidate_name'</span>]).agg({<span class="st">'votes_per_province'</span>: <span class="bu">sum</span>})</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df_senator_region[<span class="st">'rank'</span>] <span class="op">=</span> df_senator_region.groupby(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'region'</span>)[<span class="st">'votes_per_province'</span>].rank(<span class="st">'dense'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>df_senator_region <span class="op">=</span> df_senator_region[df_senator_region[<span class="st">'rank'</span>] <span class="op">==</span> <span class="dv">1</span>].reset_index()</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>df_senator_region.columns <span class="op">=</span> [<span class="st">'Region'</span>, <span class="st">'Candidate Name'</span>, <span class="st">'Votes'</span>, <span class="st">'Rank'</span>]</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>df_senator_region</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: right;"></th>
<th style="text-align: left;">Region</th>
<th style="text-align: left;">Candidate Name</th>
<th style="text-align: right;">Votes</th>
<th style="text-align: right;">Rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: left;">BARMM</td>
<td style="text-align: left;">GO, BONG GO</td>
<td style="text-align: right;">768037</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">CAR</td>
<td style="text-align: left;">MARCOS, IMEE</td>
<td style="text-align: right;">348303</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">NCR</td>
<td style="text-align: left;">VILLAR, CYNTHIA</td>
<td style="text-align: right;">3345089</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">NIR</td>
<td style="text-align: left;">VILLAR, CYNTHIA</td>
<td style="text-align: right;">856992</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">REGION I</td>
<td style="text-align: left;">MARCOS, IMEE</td>
<td style="text-align: right;">1661318</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">5</td>
<td style="text-align: left;">REGION II</td>
<td style="text-align: left;">VILLAR, CYNTHIA</td>
<td style="text-align: right;">915393</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">REGION III</td>
<td style="text-align: left;">VILLAR, CYNTHIA</td>
<td style="text-align: right;">3056167</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">7</td>
<td style="text-align: left;">REGION IV-A</td>
<td style="text-align: left;">VILLAR, CYNTHIA</td>
<td style="text-align: right;">3660112</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">8</td>
<td style="text-align: left;">REGION IV-B</td>
<td style="text-align: left;">VILLAR, CYNTHIA</td>
<td style="text-align: right;">688494</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: left;">REGION IX</td>
<td style="text-align: left;">GO, BONG GO</td>
<td style="text-align: right;">663927</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">REGION V</td>
<td style="text-align: left;">POE, GRACE</td>
<td style="text-align: right;">1417114</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">11</td>
<td style="text-align: left;">REGION VI</td>
<td style="text-align: left;">VILLAR, CYNTHIA</td>
<td style="text-align: right;">1064681</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">12</td>
<td style="text-align: left;">REGION VII</td>
<td style="text-align: left;">VILLAR, CYNTHIA</td>
<td style="text-align: right;">1307605</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">13</td>
<td style="text-align: left;">REGION VIII</td>
<td style="text-align: left;">VILLAR, CYNTHIA</td>
<td style="text-align: right;">1132757</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">14</td>
<td style="text-align: left;">REGION X</td>
<td style="text-align: left;">GO, BONG GO</td>
<td style="text-align: right;">949392</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">15</td>
<td style="text-align: left;">REGION XI</td>
<td style="text-align: left;">GO, BONG GO</td>
<td style="text-align: right;">1002771</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">16</td>
<td style="text-align: left;">REGION XII</td>
<td style="text-align: left;">VILLAR, CYNTHIA</td>
<td style="text-align: right;">983354</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">17</td>
<td style="text-align: left;">REGION XIII</td>
<td style="text-align: left;">GO, BONG GO</td>
<td style="text-align: right;">777931</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
<div class="cell" data-execution_count="21">
<details>
<summary>Code to get top senator by region and the associated number of votes</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>(df_senator_region[df_senator_region[<span class="st">'Rank'</span>] <span class="op">==</span> <span class="dv">1</span>].reset_index().groupby(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Candidate Name'</span>)[<span class="st">'Rank'</span>].<span class="bu">sum</span>().to_frame().sort_values(by<span class="op">=</span><span class="st">'Rank'</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a> .reset_index())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<table class="table">
<thead>
<tr class="header">
<th>Candidate Name</th>
<th>Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>POE, GRACE</td>
<td>1.0</td>
</tr>
<tr class="even">
<td>MARCOS, IMEE</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td>GO, BONG GO</td>
<td>5.0</td>
</tr>
<tr class="even">
<td>VILLAR, CYNTHIA</td>
<td>10.0</td>
</tr>
</tbody>
</table>
<div class="cell" data-execution_count="22">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a> fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>(df_senator_region[df_senator_region[<span class="st">'Rank'</span>] <span class="op">==</span> <span class="dv">1</span>].reset_index().groupby(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Candidate Name'</span>)[<span class="st">'Rank'</span>].<span class="bu">sum</span>().to_frame().sort_values(by<span class="op">=</span><span class="st">'Rank'</span>).plot</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a> .barh(color<span class="op">=</span><span class="st">'#BF5209'</span>, ax<span class="op">=</span>ax))<span class="op">;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Rank'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="image8-rank.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">FIGURE: Instances of candidate ranking 1 per province</figcaption><p></p>
</figure>
</div>
<p>As we can see, Cynthia Villar was ranked 1st 10 times, followed by Bong Go at 5 times, Imee Marcos at 2 times, and Grace Poe 1 time.</p>
<h3 class="anchored">
Step 4: Finding the Dominant Party Per Region
</h3>
<p>There are three main political parties vying for the senatorial seats:</p>
<ol>
<li>
Liberal Party
</li><li>
Nacionalista Party
</li><li>
Partito Demokratiko Pilipino Lakas ng Bayan (PDP-Laban)
</li></ol>
<p>We looked at the <font color="BF5209">dominant or majority political party</font> per administrative region, and identify if any regions have any affiliations to a certain party.</p>
<div class="cell" data-execution_count="23">
<details>
<summary>Code to retrieve top Party Per Region</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df_party <span class="op">=</span> df_senators.groupby([<span class="st">'region_raw'</span>, <span class="st">'party_name'</span>]).agg({</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'votes_per_province'</span>: <span class="bu">sum</span>})</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>df_party[<span class="st">'rank'</span>] <span class="op">=</span> df_party.groupby(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'region_raw'</span>)[<span class="st">'votes_per_province'</span>].rank(<span class="st">'dense'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>df_party.reset_index(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>df_leading_party <span class="op">=</span> df_party[df_party[<span class="st">'rank'</span>] <span class="op">==</span> <span class="dv">1</span>].copy()</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>df_leading_party.columns <span class="op">=</span> [<span class="st">'Region'</span>, <span class="st">'Party'</span>, <span class="st">'Votes'</span>, <span class="st">'Rank'</span>]</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>df_leading_party.sort_values([<span class="st">'Region'</span>, <span class="st">'Rank'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>df_leading_party.drop([<span class="st">'Rank'</span>, <span class="st">'index'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>This is the resulting table:</p>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 68%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>Region</th>
<th>Party</th>
<th>Votes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BARMM</td>
<td>PARTIDO DEMOKRATIKO PILIPINO LAKAS NG BAYAN</td>
<td>2596572.0</td>
</tr>
<tr class="even">
<td>CAR</td>
<td>PARTIDO DEMOKRATIKO PILIPINO LAKAS NG BAYAN</td>
<td>1028536.0</td>
</tr>
<tr class="odd">
<td>NCR</td>
<td>PARTIDO DEMOKRATIKO PILIPINO LAKAS NG BAYAN</td>
<td>10400476.0</td>
</tr>
<tr class="even">
<td>REGION I</td>
<td>NACIONALISTA PARTY</td>
<td>4361859.0</td>
</tr>
<tr class="odd">
<td>REGION II</td>
<td>NACIONALISTA PARTY</td>
<td>2474544.0</td>
</tr>
<tr class="even">
<td>REGION III</td>
<td>PARTIDO DEMOKRATIKO PILIPINO LAKAS NG BAYAN</td>
<td>7804389.0</td>
</tr>
<tr class="odd">
<td>REGION IV-A</td>
<td>PARTIDO DEMOKRATIKO PILIPINO LAKAS NG BAYAN</td>
<td>9542856.0</td>
</tr>
<tr class="even">
<td>REGION IV-B</td>
<td>PARTIDO DEMOKRATIKO PILIPINO LAKAS NG BAYAN</td>
<td>1733733.0</td>
</tr>
<tr class="odd">
<td>REGION IX</td>
<td>PARTIDO DEMOKRATIKO PILIPINO LAKAS NG BAYAN</td>
<td>2571518.0</td>
</tr>
<tr class="even">
<td>REGION V</td>
<td>LIBERAL PARTY</td>
<td>4885924.0</td>
</tr>
<tr class="odd">
<td>REGION VI</td>
<td>LIBERAL PARTY</td>
<td>4335427.0</td>
</tr>
<tr class="even">
<td>REGION VII</td>
<td>PARTIDO DEMOKRATIKO PILIPINO LAKAS NG BAYAN</td>
<td>5480074.0</td>
</tr>
<tr class="odd">
<td>REGION VIII</td>
<td>PARTIDO DEMOKRATIKO PILIPINO LAKAS NG BAYAN</td>
<td>3442654.0</td>
</tr>
<tr class="even">
<td>REGION X</td>
<td>PARTIDO DEMOKRATIKO PILIPINO LAKAS NG BAYAN</td>
<td>3697535.0</td>
</tr>
<tr class="odd">
<td>REGION XI</td>
<td>PARTIDO DEMOKRATIKO PILIPINO LAKAS NG BAYAN</td>
<td>3654361.0</td>
</tr>
<tr class="even">
<td>REGION XII</td>
<td>PARTIDO DEMOKRATIKO PILIPINO LAKAS NG BAYAN</td>
<td>3861166.0</td>
</tr>
<tr class="odd">
<td>REGION XIII</td>
<td>PARTIDO DEMOKRATIKO PILIPINO LAKAS NG BAYAN</td>
<td>2858376.0</td>
</tr>
</tbody>
</table>
<p>Next, let us generate the code to create a map with majority winners.</p>
<div class="cell" data-execution_count="24">
<details>
<summary>Code to create a map of majority winners</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>merged <span class="op">=</span> ph0.merge(df_leading_party, left_on<span class="op">=</span><span class="st">'region'</span>, right_on<span class="op">=</span><span class="st">'Region'</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> <span class="dv">18</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>color_map <span class="op">=</span> {<span class="st">'PARTIDO DEMOKRATIKO PILIPINO LAKAS NG BAYAN'</span>: <span class="st">'red'</span>, </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">'LIBERAL PARTY'</span>: <span class="st">'yellow'</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>             <span class="st">'NACIONALISTA PARTY'</span>: <span class="st">'green'</span>}</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">10</span>,<span class="dv">12</span>))<span class="op">;</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Dominant political party per region'</span>, fontsize<span class="op">=</span><span class="dv">20</span>)<span class="op">;</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> party <span class="kw">in</span> <span class="bu">list</span>(merged[<span class="st">'Party'</span>].unique()):</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    color_map[party]</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    merged[merged[<span class="st">'Party'</span>] <span class="op">==</span> party].plot(ax<span class="op">=</span>ax, color <span class="op">=</span> color_map[party], </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>                                          categorical <span class="op">=</span> <span class="va">True</span>, </span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>                                          figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">12</span>), legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>merged.geometry.boundary.plot(color<span class="op">=</span><span class="va">None</span>,edgecolor<span class="op">=</span><span class="st">'k'</span>,linewidth <span class="op">=</span> <span class="fl">.5</span>,ax<span class="op">=</span>ax)<span class="op">;</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update({<span class="st">'font.size'</span>: <span class="dv">18</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="image9-mapmajority.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">FIGURE: Top Party by Region</figcaption><p></p>
</figure>
</div>
<p>We can clearly see a voting bias of each region.</p>
<p>Majority of Region 1 and Region 2 has a voting preference towards the <bold>Nacionalista Party</bold>. This can be attributed to the fact that Imee Marcos, who hails from Ilocos Norte, is a Nacionalista.</p>
<p>Majority of Region 5 and Region 6 has a voting preference towards the <bold>LIberal Party</bold>. This is also expected since Leni Robredo, incumbent Vice President who is from the Liberal Party, is a Bicolano.</p>
<p>The remainder of the Philippines has a voting preference towards the <bold>PDP-LABAN</bold>.</p>
<h3 class="anchored">
Step 5: Finding the Dominant Coalition Per Region
</h3>
<p>Aside from individual candidates and parties, we also looked at the <strong>dominant coalition per region</strong> by counting the number of senate seats obtained by each coalition. The results indicate that HNP gained a majority of the seats across all regions, especially in Mindanao.</p>
<p>The only regions where HNP did not gain a solid majority are in Bicol Region (Region V) and Eastern Visayas (Region VI), known bailwicks of the Liberal Party. Below we created a function to get the number of seats won per coalition per region, and the associated map. The more seats won, the darker the color.</p>
<div class="cell" data-execution_count="25">
<details>
<summary>Function for get_coalition_sets()</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_coalition_seats():</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns a dataframe of the number of seats won per coalition per region</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">    coalition : pd.DataFrame</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    coalition_seats <span class="op">=</span> nle2019.query(<span class="st">'position == 1'</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    coalition_seats <span class="op">=</span> coalition_seats.groupby(</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>        [<span class="st">'region'</span>, <span class="st">'candidate_name'</span>, <span class="st">'coalition'</span>],</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>        as_index<span class="op">=</span><span class="va">False</span>).agg({<span class="st">'votes_per_province'</span>: <span class="bu">sum</span>})</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    coalition_seats <span class="op">=</span> coalition_seats.sort_values(</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>        by<span class="op">=</span>[<span class="st">'region'</span>, <span class="st">'votes_per_province'</span>], ascending<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">0</span>])</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    coalition_seats.set_index(<span class="st">'region'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    coalition_seats[<span class="st">'rank'</span>] <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        coalition_seats.candidate_name.unique())<span class="op">+</span><span class="dv">1</span>))<span class="op">\</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span> <span class="bu">len</span>(coalition_seats.index.unique())</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    coalition_seats[<span class="st">'is_top_12'</span>] <span class="op">=</span> <span class="dv">1</span><span class="op">*</span>(coalition_seats[<span class="st">'rank'</span>] <span class="op">&lt;=</span> <span class="dv">12</span>)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>    coalition_seats <span class="op">=</span> coalition_seats.reset_index()</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>    coalition_seats <span class="op">=</span> pd.pivot_table(</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>        coalition_seats, index<span class="op">=</span><span class="st">'region'</span>, columns<span class="op">=</span><span class="st">'coalition'</span>,</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>        values<span class="op">=</span><span class="st">'is_top_12'</span>, aggfunc<span class="op">=</span>np.<span class="bu">sum</span>)</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    coalition_seats[<span class="st">'coalition_seats_total'</span>] <span class="op">=</span> coalition_seats.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> coalition <span class="kw">in</span> coalition_seats.columns[:<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>        coalition_seats[<span class="st">'party_seats_pct_'</span> <span class="op">+</span> coalition] <span class="op">=</span> <span class="op">\</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>            coalition_seats[coalition] <span class="op">/</span> <span class="op">\</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>            coalition_seats[<span class="st">'coalition_seats_total'</span>]</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>        coalition_seats.rename(</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>            columns<span class="op">=</span>{coalition: <span class="st">'coalition_seats_count_'</span> <span class="op">+</span> coalition},</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>            inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>    coalition_seats <span class="op">=</span> coalition_seats.<span class="bu">round</span>(<span class="dv">5</span>)</span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>    coalition_seats <span class="op">=</span> coalition_seats.reset_index()</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> coalition_seats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="26">
<details>
<summary>Code to merge coalition dataframe and coalition_seat_counts, code to display heat map.</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>coalition <span class="op">=</span> get_coalition_seats()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>merged <span class="op">=</span> ph0.merge(coalition[[</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'region'</span>, <span class="st">'coalition_seats_count_HNP'</span>]], left_on<span class="op">=</span><span class="st">'region'</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>                   right_on<span class="op">=</span><span class="st">'region'</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">15</span>))</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>merged.plot(<span class="st">'coalition_seats_count_HNP'</span>, ax<span class="op">=</span>ax, cmap<span class="op">=</span><span class="st">'YlOrRd'</span>, legend<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Number of HNP senate seats won'</span>, fontsize<span class="op">=</span><span class="dv">24</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>merged.geometry.boundary.plot(color<span class="op">=</span><span class="va">None</span>, edgecolor<span class="op">=</span><span class="st">'k'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, ax<span class="op">=</span>ax)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="image10-hnp.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">FIGURE: Number of HNP Senate Seats Won</figcaption><p></p>
</figure>
</div>
<h3 class="anchored">
Step 6: Is Demographics Related To Voting Preferences?
</h3>
<p>Is the voting preference of a region related to its demographics such as literacy rate and religious affiliation? To answer this, we obtained the <code>2015 Census Data</code>. The directory is a collection of excel files, where each excel file corresponds to a certain region and province. If we explore each file, we can see that each sheet corresponds to a different demographic feature table. For this analysis, we are intrested at sheets <code>T8</code> and <code>T11</code>.</p>
<p>The <code>get_census_religion</code> loads the imporant columns and rows from sheet <code>T8</code>. It also adds an additional column based on the region. Similarly, the <code>get_census_education</code> loads the imporant columns and rows from sheet <code>T11</code>. It also aggregates each individual years experience column into a singular cumulative column.</p>
<p>Finally, the <code>read_census_files</code> aggregates the 2016 regional data into singular dataframe by using <code>get_census_religion</code> and <code>get_census_education</code> functions. To extract only the regional files, the <code>read_census_files</code> uses regex to get filenames with only underscores in the beginning (this is an indicator of regional data).</p>
<div class="cell" data-execution_count="27">
<details>
<summary>Function for get_censis_religion()</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_census_religion(path):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns a consolidated DataFrame of census data by religion</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">    path      : string, filepath to census directory</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">    df        : pd.DataFrame</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> os.path.basename(path)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_excel(path, sheet_name<span class="op">=</span><span class="st">'T8'</span>, header<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>                       usecols<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>],</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>                       skiprows<span class="op">=</span><span class="dv">6</span>, skip_blank_lines<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>                       skipfooter<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>                       names<span class="op">=</span>[<span class="st">'religion'</span>, <span class="st">'total'</span>, <span class="st">'m'</span>, <span class="st">'f'</span>])</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    df.sort_values(<span class="st">'total'</span>, ascending<span class="op">=</span><span class="va">False</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'region'</span>] <span class="op">=</span> re.search(<span class="vs">r'\_(.*?)\_'</span>, os.path.basename(path)).group(<span class="dv">1</span>)</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> [<span class="st">'region'</span>, <span class="st">'religion'</span>, <span class="st">'m'</span>, <span class="st">'f'</span>, <span class="st">'total'</span>]</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[cols]</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="28">
<details>
<summary>Function for get_census_education()</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_census_education(path):</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns a consolidated DataFrame of census data by education</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">    path      : string, filepath to census directory</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">    df        : pd.DataFrame</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    filename <span class="op">=</span> os.path.basename(path)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_excel(path, sheet_name<span class="op">=</span><span class="st">'T11'</span>,</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>                       usecols<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>, <span class="dv">20</span>],</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>                       skiprows<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>                       skip_blank_lines<span class="op">=</span><span class="va">True</span>, nrows<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>                       names<span class="op">=</span>[<span class="st">'education'</span>, <span class="st">'18'</span>, <span class="st">'19'</span>,</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>                              <span class="st">'20_24'</span>, <span class="st">'25_29'</span>, <span class="st">'30_34'</span>, <span class="st">'35_above'</span>])</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    df.dropna(how<span class="op">=</span><span class="st">'any'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    df.reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    df.drop(df.index[[<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">12</span>, <span class="dv">13</span>]], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'total'</span>] <span class="op">=</span> (df[<span class="st">'18'</span>] <span class="op">+</span> df[<span class="st">'19'</span>] <span class="op">+</span> df[<span class="st">'20_24'</span>] <span class="op">+</span> df[<span class="st">'25_29'</span>] <span class="op">+</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>                   df[<span class="st">'30_34'</span>] <span class="op">+</span> df[<span class="st">'35_above'</span>])</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'region'</span>] <span class="op">=</span> re.search(<span class="vs">r'\_(.*?)\_'</span>, os.path.basename(path)).group(<span class="dv">1</span>)</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    cols <span class="op">=</span> [<span class="st">'region'</span>, <span class="st">'education'</span>, <span class="st">'18'</span>, <span class="st">'19'</span>, <span class="st">'20_24'</span>, <span class="st">'25_29'</span>, <span class="st">'30_34'</span>,</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">'35_above'</span>, <span class="st">'total'</span>]</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[cols]</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="29">
<details>
<summary>Function for get_census_files()</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_census_files(path):</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Reads all census regional files</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameter</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ---------</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">    path      : string, filepath to census directory</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Dictionary of dataframes</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    total <span class="op">=</span> {<span class="st">'religion'</span>: pd.DataFrame(),</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>             <span class="st">'education'</span>: pd.DataFrame()}</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> filepath <span class="kw">in</span> glob.glob(path <span class="op">+</span> <span class="st">".xls"</span>, recursive<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> re.match(<span class="st">'_(?!PHILIPPINES)'</span>, os.path.basename(filepath)):</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>            total[<span class="st">'religion'</span>] <span class="op">=</span> (total[<span class="st">'religion'</span>]</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>                                 .append(get_census_religion(filepath)))</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>            total[<span class="st">'education'</span>] <span class="op">=</span> (total[<span class="st">'education'</span>]</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>                                  .append(get_census_education(filepath)))</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    total[<span class="st">'religion'</span>].reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    total[<span class="st">'education'</span>].reset_index(inplace<span class="op">=</span><span class="va">True</span>, drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> df <span class="kw">in</span> total.values():</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>        df.loc[(df[<span class="st">'region'</span>] <span class="op">==</span> <span class="st">"ARMM"</span>), <span class="st">'region'</span>] <span class="op">=</span> <span class="st">'BARMM'</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>        df.loc[(df[<span class="st">'region'</span>] <span class="op">==</span> <span class="st">"MIMAROPA"</span>), <span class="st">'region'</span>] <span class="op">=</span> <span class="st">'REGION IV-B'</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>        df.loc[(df[<span class="st">'region'</span>] <span class="op">==</span> <span class="st">"CARAGA"</span>), <span class="st">'region'</span>] <span class="op">=</span> <span class="st">'REGION XIII'</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="30">
<details>
<summary>Code to execute get_census_education amd get_census_religion</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>census_path <span class="op">=</span> <span class="st">'/mnt/data/public/census/*'</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>census_dict <span class="op">=</span> read_census_files(census_path)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<h3 class="anchored">
Step 6.1: Is literacy rate related to voting preference?
</h3>
<p>We looked at the number of seats obtained by each coalition per region, then correlated it to literacy rate. Education information was obtained from the 2015 Census data.</p>
<p>We looked at the literacy rate <span class="math inline">\(\frac{n_{educated}}{n_{total}}\)</span> of each administrative region:</p>
<div class="cell" data-execution_count="31">
<details>
<summary>Function for get_education_percent()</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_education_percent():</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Gets percentage of educational level per region</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    education <span class="op">=</span> census_dict[<span class="st">'education'</span>].groupby(</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>        [<span class="st">'region'</span>, <span class="st">'education'</span>], as_index<span class="op">=</span><span class="va">False</span>).<span class="bu">sum</span>()</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    education <span class="op">=</span> pd.pivot_table(</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>        education, index<span class="op">=</span><span class="st">'region'</span>, columns<span class="op">=</span><span class="st">'education'</span>, values<span class="op">=</span><span class="st">'total'</span>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    education.columns <span class="op">=</span> [<span class="st">'education_pct_'</span> <span class="op">+</span> educ <span class="cf">for</span> educ <span class="kw">in</span> education.columns]</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    education[<span class="st">'education_total'</span>] <span class="op">=</span> education.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> educ <span class="kw">in</span> education.columns[:<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>        education[educ] <span class="op">/=</span> education[<span class="st">'education_total'</span>]</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    education.drop(<span class="st">'education_total'</span>, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    education <span class="op">=</span> education.<span class="bu">round</span>(<span class="dv">5</span>)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> education</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="32">
<details>
<summary>Function for get_agg_education_percent()</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_agg_education_percent():</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Gets aggregated percentage of educational level per region</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    df_educ <span class="op">=</span> get_education_percent()</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    df_educ <span class="op">=</span> df_educ.reset_index()</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    df_educ[<span class="st">'educated'</span>] <span class="op">=</span> (<span class="dv">1</span> <span class="op">-</span> df_educ[<span class="st">'education_pct_No Grade Completed'</span>]</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>                           <span class="op">-</span> df_educ[<span class="st">'education_pct_Not Stated'</span>])</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    df_educ[<span class="st">'not_educated'</span>] <span class="op">=</span> df_educ[<span class="st">'education_pct_No Grade Completed'</span>]</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    df_educ[<span class="st">'unknown'</span>] <span class="op">=</span> df_educ[<span class="st">'education_pct_Not Stated'</span>]</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    df_educ.drop(columns<span class="op">=</span>[<span class="st">'education_pct_Academic Degree Holder'</span>,</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>                          <span class="st">'education_pct_College Undergraduate'</span>,</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>                          <span class="st">'education_pct_Elementary'</span>,</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>                          <span class="st">'education_pct_High School'</span>,</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>                          <span class="st">'education_pct_No Grade Completed'</span>,</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>                          <span class="st">'education_pct_Not Stated'</span>,</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>                          <span class="st">'education_pct_Post Baccalaureate'</span>,</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>                          <span class="st">'education_pct_Post-Secondary'</span>,</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>                          <span class="st">'education_pct_Pre-School'</span>,</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>                          <span class="st">'education_pct_Special Education'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    df_educ.set_index(<span class="st">'region'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    df_educ.reset_index(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_educ</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-execution_count="33">
<details>
<summary>Code to run get_agg_education_percent()</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df_educ <span class="op">=</span> get_agg_education_percent()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>df_educ</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The output table shows the literacy table per region. The main columns shows the percentage that are <code>educated</code>, <code>not_educated</code> and <code>unknown</code>.</p>
<table class="table">
<thead>
<tr class="header">
<th>region</th>
<th>educated</th>
<th>not_educated</th>
<th>unknown</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BARMM</td>
<td>0.85355</td>
<td>0.14105</td>
<td>0.00540</td>
</tr>
<tr class="even">
<td>CAR</td>
<td>0.97376</td>
<td>0.02622</td>
<td>0.00002</td>
</tr>
<tr class="odd">
<td>NCR</td>
<td>0.99234</td>
<td>0.00221</td>
<td>0.00545</td>
</tr>
<tr class="even">
<td>NIR</td>
<td>0.98085</td>
<td>0.01882</td>
<td>0.00033</td>
</tr>
<tr class="odd">
<td>REGION I</td>
<td>0.99321</td>
<td>0.00679</td>
<td>0.00000</td>
</tr>
<tr class="even">
<td>REGION II</td>
<td>0.98610</td>
<td>0.01389</td>
<td>0.00001</td>
</tr>
<tr class="odd">
<td>REGION III</td>
<td>0.99355</td>
<td>0.00615</td>
<td>0.00030</td>
</tr>
<tr class="even">
<td>REGION IV-A</td>
<td>0.99473</td>
<td>0.00519</td>
<td>0.00008</td>
</tr>
<tr class="odd">
<td>REGION IV-B</td>
<td>0.96573</td>
<td>0.03417</td>
<td>0.00010</td>
</tr>
<tr class="even">
<td>REGION IX</td>
<td>0.96456</td>
<td>0.03486</td>
<td>0.00058</td>
</tr>
<tr class="odd">
<td>REGION V</td>
<td>0.99126</td>
<td>0.00851</td>
<td>0.00023</td>
</tr>
<tr class="even">
<td>REGION VI</td>
<td>0.98721</td>
<td>0.01257</td>
<td>0.00022</td>
</tr>
<tr class="odd">
<td>REGION VII</td>
<td>0.98753</td>
<td>0.01209</td>
<td>0.00038</td>
</tr>
<tr class="even">
<td>REGION VIII</td>
<td>0.97679</td>
<td>0.02297</td>
<td>0.00024</td>
</tr>
<tr class="odd">
<td>REGION X</td>
<td>0.98095</td>
<td>0.01856</td>
<td>0.00049</td>
</tr>
<tr class="even">
<td>REGION XI</td>
<td>0.97818</td>
<td>0.02050</td>
<td>0.00132</td>
</tr>
<tr class="odd">
<td>REGION XII</td>
<td>0.94792</td>
<td>0.05034</td>
<td>0.00174</td>
</tr>
<tr class="even">
<td>REGION XIII</td>
<td>0.98487</td>
<td>0.01503</td>
<td>0.00010</td>
</tr>
</tbody>
</table>
<p>We then checked if the number of seats obtained by each coalition is correlated to the literacy rate of that region. First, we obtained the number of seats obtained by each coalition per region:</p>
<div class="cell" data-execution_count="34">
<details>
<summary>Function for get_coalition_rank()</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_coalition_rank():</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Get number of seats obtained by each coalition</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    coalition_seats <span class="op">=</span> nle2019.query(<span class="st">'position == 1'</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    coalition_seats <span class="op">=</span> coalition_seats.groupby(</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        [<span class="st">'region'</span>, <span class="st">'candidate_name'</span>, <span class="st">'coalition'</span>], as_index<span class="op">=</span><span class="va">False</span>).agg({<span class="st">'votes_per_province'</span>: <span class="bu">sum</span>})</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    coalition_seats <span class="op">=</span> coalition_seats.sort_values(</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        by<span class="op">=</span>[<span class="st">'region'</span>, <span class="st">'votes_per_province'</span>], ascending<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">0</span>])</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    coalition_seats.set_index(<span class="st">'region'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    coalition_seats[<span class="st">'rank'</span>] <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>        coalition_seats.candidate_name.unique())<span class="op">+</span><span class="dv">1</span>)) <span class="op">*</span> <span class="bu">len</span>(coalition_seats.index.unique())</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    coalition_seats[<span class="st">'is_top_12'</span>] <span class="op">=</span> <span class="dv">1</span><span class="op">*</span>(coalition_seats[<span class="st">'rank'</span>] <span class="op">&lt;=</span> <span class="dv">12</span>)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    coalition_seats.reset_index(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    coalition_seats <span class="op">=</span> pd.pivot_table(</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>        coalition_seats, index<span class="op">=</span><span class="st">'region'</span>, columns<span class="op">=</span><span class="st">'coalition'</span>, values<span class="op">=</span><span class="st">'is_top_12'</span>, aggfunc<span class="op">=</span>np.<span class="bu">sum</span>)</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> coalition_seats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We then merge this with the education dataframe, then get the correlation by using python’s <code>corr</code> method:</p>
<div class="cell" data-execution_count="35">
<details>
<summary>Code to run get_agg_education_percent() and create a a correlation graph.</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df_coal_educ <span class="op">=</span> get_agg_education_percent().set_index(<span class="st">'region'</span>).join(get_coalition_rank())</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>df_coal_educ[<span class="st">'Educated'</span>] <span class="op">=</span> df_coal_educ[<span class="st">'educated'</span>]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>df_coal_educ[<span class="st">'Not Educated'</span>] <span class="op">=</span> df_coal_educ[<span class="st">'not_educated'</span>]</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> df_coal_educ.corr().loc[[<span class="st">'Otso Diretso'</span>, <span class="st">'HNP'</span>],[<span class="st">'Educated'</span>, <span class="st">'Not Educated'</span>]]</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>colormap <span class="op">=</span> sns.diverging_palette(<span class="dv">100</span>, <span class="dv">100</span>, n <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr, cmap<span class="op">=</span>colormap, annot<span class="op">=</span><span class="va">True</span>, vmin <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>, vmax <span class="op">=</span> <span class="dv">1</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="image11-correlation.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">FIGURE: Correlation Matrix between Education and Coalition</figcaption><p></p>
</figure>
</div>
<p>The Census and election data show that the voting preference of a region has no correlation with its literacy rate. We now look at religion to see if it has a correlation with the voting preference.</p>
<h3 class="anchored">
Step 6.2: Is literacy rate related to voting preference?
</h3>
<p>We also looked into the religious affiliation per region, and checked if it is correlatd with voting preference.</p>
<p>First, we obtained the distribution of religions per region from the Census data:</p>
<div class="cell" data-execution_count="36">
<details>
<summary>Function for get_religion_percent()</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_religion_percent():</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Get percentages of religion per region</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    religion <span class="op">=</span> census_dict[<span class="st">'religion'</span>].groupby(</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>        [<span class="st">'region'</span>, <span class="st">'religion'</span>], as_index<span class="op">=</span><span class="va">False</span>).<span class="bu">sum</span>()</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    religion <span class="op">=</span> pd.pivot_table(</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>        religion, index<span class="op">=</span><span class="st">'region'</span>, columns<span class="op">=</span><span class="st">'religion'</span>, values<span class="op">=</span><span class="st">'total'</span>)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    religion.columns <span class="op">=</span> [<span class="st">'religion_pct_'</span> <span class="op">+</span> rel <span class="cf">for</span> rel <span class="kw">in</span> religion.columns]</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    religion[<span class="st">'religion_total'</span>] <span class="op">=</span> religion.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> rel <span class="kw">in</span> religion.columns[:<span class="op">-</span><span class="dv">1</span>]:</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>        religion[rel] <span class="op">/=</span> religion[<span class="st">'religion_total'</span>]</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    religion.drop(<span class="st">'religion_total'</span>, axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    religion <span class="op">=</span> religion.<span class="bu">round</span>(<span class="dv">5</span>)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> religion</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>df_rel <span class="op">=</span> get_religion_percent()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We then merged the religion census data with the coalition ranking data to check if religion has correlation with the number of seats obtained by each coalition:</p>
<div class="cell" data-execution_count="37">
<details>
<summary>Joining the coalition rank dataframe with the output from the get_religion_percent() function.</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df_coal_rel <span class="op">=</span> get_religion_percent().join(get_coalition_rank())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>From getting the correlation of the religion data with the number of seats per coalition, it is apparent that the Voting preference of a region has <strong>no correlation with its religious affiliation</strong>.</p>
<div class="cell" data-execution_count="38">
<details>
<summary>Code to get a correlation graph between Religion and Top Coalition Party.</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df_coal_rel[<span class="st">'Roman Catholic'</span>] <span class="op">=</span> df_coal_rel[<span class="st">'religion_pct_Roman Catholic, including Catholic Charismatic'</span>]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>df_coal_rel[<span class="st">'Islam'</span>] <span class="op">=</span> df_coal_rel[<span class="st">'religion_pct_Islam'</span>]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>df_coal_rel[<span class="st">'Iglesia ni Cristo'</span>] <span class="op">=</span> df_coal_rel[<span class="st">'religion_pct_Iglesia ni Cristo'</span>]</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> df_coal_rel.corr().loc[</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Roman Catholic'</span>,<span class="st">'Islam'</span>,<span class="st">'Iglesia ni Cristo'</span>],[<span class="st">'HNP'</span>,<span class="st">'Otso Diretso'</span>]]</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>colormap <span class="op">=</span> sns.diverging_palette(<span class="dv">100</span>, <span class="dv">100</span>, n <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr, cmap<span class="op">=</span>colormap, annot<span class="op">=</span><span class="va">True</span>, vmin <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>, vmax <span class="op">=</span> <span class="dv">1</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-left">
<figure class="figure">
<p><img src="image12-correlation.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">FIGURE: Correlation Matrix between Religion and Coalition</figcaption><p></p>
</figure>
</div>
<h2 class="anchored" data-anchor-id="next-let-us-examine-the-obtained-dataset-with-actual-election-results.">
Conclusion
</h2>
<p>Upon checking both the Comelec 2019 Election Results and the 2015 Philippine Census data, we found out that voting preference is characterized by high regionality.</p>
<p>Candidates have a homecourt advantage, and voters tend to vote candidates or parties affiliated with their home region.</p>
<p>Also, literacy rate and religious affiliation is not correlated to voting preference.</p>
<hr>
<p><i class="appendix">Images: https://primer.com.ph/blog/2016/02/04/philippine-elections-the-culture-the-drama-the-battle-2/</i></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>